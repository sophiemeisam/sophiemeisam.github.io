<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gieo Qu·∫ª D·ªãch v·ªõi ƒê·ªìng Xu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .bathuong-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .bathuong {
            width: 131px;
            height: auto;
        }
        .coin-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .coin {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        .coin img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .flip {
            animation: flipAnimation 1s ease-in-out;
        }
        @keyframes flipAnimation {
            0% { transform: rotateY(0deg) translateY(0); }
            50% { transform: rotateY(720deg) translateY(-100px); }
            100% { transform: rotateY(0deg) translateY(0); }
        }
        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin: 5px 0;
        }
        button:hover {
            background-color: #45a049;
        }
        #ket_qua {
            margin-top: 20px;
            text-align: left;
            font-family: monospace;
            font-size: 16px;
        }
        .hao {
            margin-bottom: 10px;
        }
        .hao-dong {
            color: red; /* H√†o ƒë·ªông hi·ªÉn th·ªã m√†u ƒë·ªè */
        }
        #ten_que {
            margin-top: 10px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- B√°t h∆∞∆°ng ·ªü tr√™n c√πng -->
        <div class="bathuong-container">
            <img src="https://sophiemeisam.github.io/Thien.png" alt="B√°t H∆∞∆°ng" class="bathuong">
        </div>
        <!-- ƒê·ªìng xu ngay d∆∞·ªõi b√°t h∆∞∆°ng -->
        <div class="coin-container">
            <div class="coin" id="coin1"><img src="https://sophiemeisam.github.io/duong.jpg" alt="Coin"></div>
            <div class="coin" id="coin2"><img src="https://sophiemeisam.github.io/duong.jpg" alt="Coin"></div>
            <div class="coin" id="coin3"><img src="https://sophiemeisam.github.io/duong.jpg" alt="Coin"></div>
        </div>
        <!-- √î nh·∫≠p s·ª± vi·ªác, n√∫t Gieo Qu·∫ª, v√† t√™n qu·∫ª -->
        <div>
            <h2>Gieo Qu·∫ª D·ªãch</h2>
            <input type="text" id="su_viec" placeholder="Nh·∫≠p s·ª± vi·ªác c·∫ßn xem">
            <button onclick="gieoQue()">Gieo Qu·∫ª</button>
            <div id="ten_que"></div>
            <!-- n√∫t ch·ª•p qu·∫ª -->
            <button onclick="chupQue()">üì∏ Ch·ª•p qu·∫ª</button>
        </div>
        <!-- K·∫øt qu·∫£ qu·∫ª ·ªü d∆∞·ªõi c√πng -->
        <div id="ket_qua">
            <div class="hao" id="hao6">H√†o 6: </div>
            <div class="hao" id="hao5">H√†o 5: </div>
            <div class="hao" id="hao4">H√†o 4: </div>
            <div class="hao" id="hao3">H√†o 3: </div>
            <div class="hao" id="hao2">H√†o 2: </div>
            <div class="hao" id="hao1">H√†o 1: </div>
        </div>
    </div>

    <script>
        // Link ·∫£nh cho m·∫∑t h√¨nh v√† m·∫∑t ch·ªØ
        const headsImage = 'https://sophiemeisam.github.io/duong.jpg';
        const tailsImage = 'https://sophiemeisam.github.io/am.jpg';
        const queDon = {
            '111': 'Ki·ªÅn','011': 'ƒêo√†i','101': 'Ly','001': 'Ch·∫•n',
            '110': 'T·ªën','010': 'Kh·∫£m','100': 'C·∫•n','000': 'Kh√¥n'
        };
        const queKep = {
            '111111': 'Thu·∫ßn Ki·ªÅn','111110': 'Thi√™n Phong C·∫•u','111100': 'Thi√™n S∆°n ƒê·ªôn','111000': 'Thi√™n ƒê·ªãa Bƒ©',
            '110000': 'Phong ƒê·ªãa Qu√°n','100000': 'S∆°n ƒê·ªãa B√°c','101000': 'Ho·∫£ ƒê·ªãa T·∫•n','101111': 'Ho·∫£ Thi√™n ƒê·∫°i H·ªØu',
            '011011': 'Thu·∫ßn ƒêo√†i','011010': 'Tr·∫°ch Th·ªßy Kh·ªën','011000': 'Tr·∫°ch ƒê·ªãa T·ª•y','011100': 'Tr·∫°ch S∆°n H√†m',
            '010100': 'Th·ªßy S∆°n Ki·ªÉn','000100': 'ƒê·ªãa S∆°n Khi√™m','001100': 'L√¥i S∆°n Ti·ªÉu Qu√°','001011': 'L√¥i Tr·∫°ch Quy Mu·ªôi',
            '101101': 'Thu·∫ßn Ly','101100': 'Ho·∫£ S∆°n L·ªØ','101110': 'Ho·∫£ Phong ƒê·ªânh','101010': 'Ho·∫£ Th·ªßy V·ªã T·∫ø',
            '100010': 'S∆°n Th·ªßy M√¥ng','110010': 'Phong Th·ªßy Ho√°n','111010': 'Thi√™n Th·ªßy T·ª•ng','111101': 'Thi√™n Ho·∫£ ƒê·ªìng Nh√¢n',
            '001001': 'Thu·∫ßn Ch·∫•n','001000': 'L√¥i ƒê·ªãa D·ª±','001010': 'L√¥i Th·ªßy Gi·∫£i','001110': 'L√¥i Phong H·∫±ng',
            '000110': 'ƒê·ªãa Phong ThƒÉng','010110': 'Th·ªßy Phong Tƒ©nh','011110': 'Tr·∫°ch Phong ƒê·∫°i Qu√°','011001': 'Tr·∫°ch L√¥i T√πy',
            '110110': 'Thu·∫ßn T·ªën','110111': 'Phong Thi√™n Ti·ªÉu S√∫c','110101': 'Phong Ho·∫£ Gia Nh√¢n','110001': 'Phong L√¥i √çch',
            '111001': 'Thi√™n L√¥i V√¥ V·ªçng','101001': 'Ho·∫£ L√¥i Ph·ªá H·∫°p','100001': 'S∆°n L√¥i Di','100110': 'S∆°n Phong C·ªï',
            '010010': 'Thu·∫ßn Kh·∫£m','010011': 'Th·ªßy Tr·∫°ch Ti·∫øt','010001': 'Th·ªßy L√¥i Tru√¢n','010101': 'Th·ªßy Ho·∫£ K√Ω T·∫ø',
            '011101': 'Tr·∫°ch Ho·∫£ C√°ch','001101': 'L√¥i Ho·∫£ Phong','000101': 'ƒê·ªãa Ho·∫£ Minh Di','000010': 'ƒê·ªãa Th·ªßy S∆∞',
            '100100': 'Thu·∫ßn C·∫•n','100101': 'S∆°n Ho·∫£ B√≠','100111': 'S∆°n Thi√™n ƒê·∫°i S√∫c','100011': 'S∆°n Tr·∫°ch T·ªïn',
            '101011': 'Ho·∫£ Tr·∫°ch Khu√™','111011': 'Thi√™n Tr·∫°ch L√Ω','110011': 'Phong Tr·∫°ch Trung Phu','110100': 'Phong S∆°n Ti·ªám',
            '000000': 'Thu·∫ßn Kh√¥n','000001': 'ƒê·ªãa L√¥i Ph·ª•c','000011': 'ƒê·ªãa Tr·∫°ch L√¢m','000111': 'ƒê·ªãa Thi√™n Th√°i',
            '001111': 'L√¥i Thi√™n ƒê·∫°i Tr√°ng','011111': 'Tr·∫°ch Thi√™n Qu·∫£i','010111': 'Th·ªßy Thi√™n Nhu','010000': 'Th·ªßy ƒê·ªãa T·ª∑'
        };

        function flipCoins() {
            const coins = document.querySelectorAll('.coin img');
            const results = [];
            coins.forEach(coin => {
                coin.parentElement.classList.add('flip');
                const isHeads = Math.random() > 0.5;
                results.push(isHeads ? 'duong' : 'am');
                setTimeout(() => {
                    coin.src = isHeads ? headsImage : tailsImage;
                    coin.parentElement.classList.remove('flip');
                }, 3000);
            });
            return results;
        }

        function gieoQue() {
            const suViec = document.getElementById('su_viec').value;
            const ketQuaDiv = document.getElementById('ket_qua');
            const tenQueDiv = document.getElementById('ten_que');

            // reset/hi·ªÉn th·ªã s·ª± vi·ªác
            ketQuaDiv.innerHTML = `<p>S·ª± vi·ªác: ${suViec || 'Kh√¥ng nh·∫≠p'}</p>`;
            tenQueDiv.innerHTML = '';

            const lines = [];     // gi·ªØ 'duong' ho·∫∑c 'am' theo th·ª© t·ª± l·∫•y
            const dongHao = [];   // danh s√°ch h√†o ƒë·ªông (s·ªë)
            let haoIndex = 0;

            // t·∫°o 6 h√†o placeholder (h√†o6..hao1 ƒë√£ t·ªìn t·∫°i trong HTML, nh∆∞ng ta ƒë·∫∑t l·∫°i n·ªôi dung)
            for (let i = 6; i >= 1; i--) {
                const haoDiv = document.createElement('div');
                haoDiv.className = 'hao';
                haoDiv.id = `hao${i}`;
                haoDiv.innerHTML = `H√†o ${i}: `;
                ketQuaDiv.appendChild(haoDiv);
            }

            // tungHao: gieo t·ª´ng h√†o, gi·ªØa c√°c h√†o ch·ªù 9s,
            // nh∆∞ng sau khi h√†o6 xong => hi·ªán t√™n qu·∫ª ngay l·∫≠p t·ª©c (kh√¥ng ch·ªù).
            function tungHao() {
                if (haoIndex < 6) {
                    const coinResults = flipCoins();
                    const sum = coinResults.filter(result => result === 'duong').length;
                    let haoType, haoDisplay, isDong;
                    if (sum === 0) {
                        haoType = 'am';
                        haoDisplay = '‚Äî ‚Äî (√¢m, ƒë·ªông)';
                        isDong = true;
                    } else if (sum === 1) {
                        haoType = 'am';
                        haoDisplay = '‚Äî ‚Äî (√¢m)';
                        isDong = false;
                    } else if (sum === 2) {
                        haoType = 'duong';
                        haoDisplay = '‚Äî‚Äî‚Äî‚Äî‚Äî (d∆∞∆°ng)';
                        isDong = false;
                    } else {
                        haoType = 'duong';
                        haoDisplay = '‚Äî‚Äîo‚Äî‚Äî (d∆∞∆°ng, ƒë·ªông)';
                        isDong = true;
                    }

                    lines.push(haoType);
                    if (isDong) dongHao.push(haoIndex + 1);

                    const haoToUpdate = document.getElementById(`hao${haoIndex + 1}`);
                    haoToUpdate.innerHTML = `H√†o ${haoIndex + 1}: ${haoDisplay}`;
                    if (isDong) haoToUpdate.classList.add('hao-dong'); else haoToUpdate.classList.remove('hao-dong');

                    haoIndex++;

                    // n·∫øu ch∆∞a ƒë·ªß 6 h√†o -> ch·ªù 9s ƒë·ªÉ gieo ti·∫øp (th·ªùi gian ƒë·ªÉ kh·∫•n)
                    if (haoIndex < 6) {
                        setTimeout(tungHao, 9000);
                    } else {
                        // ƒë√£ l·∫•y ƒë·ªß 6 h√†o -> hi·ªán t√™n qu·∫ª ngay l·∫≠p t·ª©c (kh√¥ng ch·ªù th√™m)
                        const binaryLines = [...lines].reverse().map(line => line === 'duong' ? '1' : '0');
                        const thuongQuai = [binaryLines[0], binaryLines[1], binaryLines[2]].join('');
                        const haQuai = [binaryLines[3], binaryLines[4], binaryLines[5]].join('');
                        const queKepCode = thuongQuai + haQuai;

                        const tenThuongQuai = queDon[thuongQuai] || 'Kh√¥ng x√°c ƒë·ªãnh';
                        const tenHaQuai = queDon[haQuai] || 'Kh√¥ng x√°c ƒë·ªãnh';
                        const tenQueKep = queKep[queKepCode] || 'Kh√¥ng x√°c ƒë·ªãnh';

                        let displayText = `Qu·∫ª: ${tenQueKep} (Th∆∞·ª£ng: ${tenThuongQuai}, H·∫°: ${tenHaQuai})`;
                        if (dongHao.length > 0) {
                            displayText += `, ƒë·ªông h√†o ${dongHao.sort((a,b) => a - b).join(', ')}`;
                        } else {
                            displayText += ', kh√¥ng c√≥ h√†o ƒë·ªông';
                        }
                        tenQueDiv.innerHTML = displayText;
                    }
                }
            }

            // b·∫Øt ƒë·∫ßu gieo t·ª´ h√†o 1
            tungHao();
        }

        // T·ª± ƒë·ªông tung xu khi t·∫£i trang (kh√¥ng can thi·ªáp ch·ª©c nƒÉng gieo qu·∫ª)
        setInterval(flipCoins, 9000);
    </script>

    <!-- html2canvas + chupQue (gi·ªØ nguy√™n logic: download tr√™n Chrome; fallback hi·ªÉn th·ªã ·∫£nh cho Zalo) -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script>
    function chupQue() {
        try {
            const tenque = document.getElementById("ten_que");
            const ketqua = document.getElementById("ket_qua");
            if (!tenque || !ketqua) {
                alert("Ch∆∞a c√≥ k·∫øt qu·∫£ qu·∫ª ƒë·ªÉ ch·ª•p. Vui l√≤ng gieo qu·∫ª tr∆∞·ªõc.");
                return;
            }

            // Th·ªùi gian hi·ªán t·∫°i
            let now = new Date();
            let hours = String(now.getHours()).padStart(2, '0');
            let minutes = String(now.getMinutes()).padStart(2, '0');
            let day = String(now.getDate()).padStart(2, '0');
            let month = String(now.getMonth() + 1).padStart(2, '0');
            let year = now.getFullYear();
            let text = `${hours}:${minutes}     ${day}.${month}.${year}`;

            // V√πng t·∫°m (off-screen)
            const tmp = document.createElement("div");
            tmp.style.position = "fixed";
            tmp.style.left = "-9999px";
            tmp.style.top = "0";
            tmp.style.background = "#ffffff";
            tmp.style.padding = "12px";
            tmp.style.boxSizing = "border-box";
            tmp.style.fontFamily = window.getComputedStyle(document.body).fontFamily;

            // Th√™m d√≤ng th·ªùi gian tr∆∞·ªõc t√™n qu·∫ª (m√†u ƒë·ªè ƒë·∫≠m)
            const timeDiv = document.createElement("div");
            timeDiv.textContent = text;
            timeDiv.style.fontSize = "18px";
            timeDiv.style.fontWeight = "bold";
            timeDiv.style.marginBottom = "8px";
            timeDiv.style.color = "#cc0000";
            tmp.appendChild(timeDiv);

            tmp.appendChild(tenque.cloneNode(true));
            tmp.appendChild(ketqua.cloneNode(true));
            document.body.appendChild(tmp);

            html2canvas(tmp, {
                useCORS: true,
                scale: window.devicePixelRatio || 2,
                backgroundColor: "#ffffff"
            })
            .then(canvas => {
                // N·∫øu browser h·ªó tr·ª£ download (Chrome/Edge/Firefox)
                if (typeof canvas.toBlob === "function" && "download" in document.createElement("a")) {
                    canvas.toBlob(function(blob) {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement("a");
                        a.href = url;
                        a.download = "que_kinh_dich.png";
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(() => {
                            URL.revokeObjectURL(url);
                            if (a.parentNode) a.parentNode.removeChild(a);
                            if (tmp.parentNode) tmp.parentNode.removeChild(tmp);
                        }, 150);
                    }, "image/png");
                } else {
                    // Zalo browser ho·∫∑c browser h·∫°n ch·∫ø -> hi·ªÉn th·ªã ·∫£nh cho user nh·∫•n gi·ªØ l∆∞u
                    const dataUrl = canvas.toDataURL("image/png");
                    const img = new Image();
                    img.src = dataUrl;
                    img.style.maxWidth = "100%";
                    img.style.display = "block";
                    img.style.margin = "12px auto";
                    document.body.appendChild(img);
                    alert("üëâ Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ t·∫£i tr·ª±c ti·∫øp.\nNh·∫•n gi·ªØ v√†o ·∫£nh ƒë·ªÉ l∆∞u v·ªÅ m√°y.");
                    if (tmp.parentNode) tmp.parentNode.removeChild(tmp);
                }
            })
            .catch(err => {
                if (tmp.parentNode) tmp.parentNode.removeChild(tmp);
                console.error("html2canvas error:", err);
                alert("Ch·ª•p ·∫£nh th·∫•t b·∫°i ‚Äî ki·ªÉm tra console.");
            });
        } catch(e) {
            console.error(e);
            alert("L·ªói n·ªôi b·ªô: " + (e && e.message ? e.message : e));
        }
    }
    </script>
</body>
</html>