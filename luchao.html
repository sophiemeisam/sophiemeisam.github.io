<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gieo Quẻ Dịch với Đồng Xu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .bathuong-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .bathuong {
            width: 300px;
            height: auto;
        }
        .coin-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .coin {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        .coin img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .flip {
            animation: flipAnimation 1s ease-in-out;
        }
        @keyframes flipAnimation {
            0% { transform: rotateY(0deg) translateY(0); }
            50% { transform: rotateY(720deg) translateY(-100px); }
            100% { transform: rotateY(0deg) translateY(0); }
        }
        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        #ket_qua {
            margin-top: 20px;
            text-align: left;
            font-family: monospace;
            font-size: 16px;
        }
        .hao {
            margin-bottom: 10px;
        }
        .hao-dong {
            color: red; /* Hào động hiển thị màu đỏ */
        }
        #ten_que {
            margin-top: 10px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Bát hương ở trên cùng -->
        <div class="bathuong-container">
            <img src="https://sophiemeisam.github.io/bathuong.png" alt="Bát Hương" class="bathuong">
        </div>

        <!-- Đồng xu ngay dưới bát hương -->
        <div class="coin-container">
            <div class="coin" id="coin1"><img src="https://sophiemeisam.github.io/duong.jpg" alt="Coin"></div>
            <div class="coin" id="coin2"><img src="https://sophiemeisam.github.io/duong.jpg" alt="Coin"></div>
            <div class="coin" id="coin3"><img src="https://sophiemeisam.github.io/duong.jpg" alt="Coin"></div>
        </div>

        <!-- Ô nhập sự việc, nút Gieo Quẻ, và tên quẻ -->
        <div>
            <h2>Gieo Quẻ Dịch</h2>
            <input type="text" id="su_viec" placeholder="Nhập sự việc cần xem">
            <button onclick="gieoQue()">Gieo Quẻ</button>
            <div id="ten_que"></div>
        </div>

        <!-- Kết quả quẻ ở dưới cùng -->
        <div id="ket_qua">
            <div class="hao" id="hao6">Hào 6: </div>
            <div class="hao" id="hao5">Hào 5: </div>
            <div class="hao" id="hao4">Hào 4: </div>
            <div class="hao" id="hao3">Hào 3: </div>
            <div class="hao" id="hao2">Hào 2: </div>
            <div class="hao" id="hao1">Hào 1: </div>
        </div>
    </div>

    <script>
        // Link ảnh cho mặt hình và mặt chữ
        const headsImage = 'https://sophiemeisam.github.io/duong.jpg'; // Mặt hình (dương)
        const tailsImage = 'https://sophiemeisam.github.io/am.jpg'; // Mặt chữ (âm)

        // Bảng quẻ đơn
        const queDon = {
            '111': 'Kiền',
            '011': 'Đoài',
            '101': 'Ly',
            '001': 'Chấn',
            '110': 'Tốn',
            '010': 'Khảm',
            '100': 'Cấn',
            '000': 'Khôn'
        };

        // Bảng quẻ kép
        const queKep = {
            '111111': 'Thuần Kiền',
            '111110': 'Thiên Phong Cấu',
            '111100': 'Thiên Sơn Độn',
            '111000': 'Thiên Địa Bĩ',
            '110000': 'Phong Địa Quán',
            '100000': 'Sơn Địa Bác',
            '101000': 'Hoả Địa Tấn',
            '101111': 'Hoả Thiên Đại Hữu',
            '011011': 'Thuần Đoài',
            '011010': 'Trạch Thủy Khốn',
            '011000': 'Trạch Địa Tụy',
            '011100': 'Trạch Sơn Hàm',
            '010100': 'Thủy Sơn Kiển',
            '000100': 'Địa Sơn Khiêm',
            '001100': 'Lôi Sơn Tiểu Quá',
            '001011': 'Lôi Trạch Quy Muội',
            '101101': 'Thuần Ly',
            '101100': 'Hoả Sơn Lữ',
            '101110': 'Hoả Phong Đỉnh',
            '101010': 'Hoả Thủy Vị Tế',
            '100010': 'Sơn Thủy Mông',
            '110010': 'Phong Thủy Hoán',
            '111010': 'Thiên Thủy Tụng',
            '111101': 'Thiên Hoả Đồng Nhân',
            '001001': 'Thuần Chấn',
            '001000': 'Lôi Địa Dự',
            '001010': 'Lôi Thủy Giải',
            '001110': 'Lôi Phong Hằng',
            '000110': 'Địa Phong Thăng',
            '010110': 'Thủy Phong Tĩnh',
            '011110': 'Trạch Phong Đại Quá',
            '011001': 'Trạch Lôi Tùy',
            '110110': 'Thuần Tốn',
            '110111': 'Phong Thiên Tiểu Súc',
            '110101': 'Phong Hoả Gia Nhân',
            '110001': 'Phong Lôi Ích',
            '111001': 'Thiên Lôi Vô Vọng',
            '101001': 'Hoả Lôi Phệ Hạp',
            '100001': 'Sơn Lôi Di',
            '100110': 'Sơn Phong Cổ',
            '010010': 'Thuần Khảm',
            '010011': 'Thủy Trạch Tiết',
            '010001': 'Thủy Lôi Truân',
            '010101': 'Thủy Hoả Ký Tế',
            '011101': 'Trạch Hoả Cách',
            '001101': 'Lôi Hoả Phong',
            '000101': 'Địa Hoả Minh Di',
            '000010': 'Địa Thủy Sư',
            '100100': 'Thuần Cấn',
            '100101': 'Sơn Hoả Bí',
            '100111': 'Sơn Thiên Đại Súc',
            '100011': 'Sơn Trạch Tổn',
            '101011': 'Hoả Trạch Khuê',
            '111011': 'Thiên Trạch Lý',
            '110011': 'Phong Trạch Trung Phu',
            '110100': 'Phong Sơn Tiệm',
            '000000': 'Thuần Khôn',
            '000001': 'Địa Lôi Phục',
            '000011': 'Địa Trạch Lâm',
            '000111': 'Địa Thiên Thái',
            '001111': 'Lôi Thiên Đại Tráng',
            '011111': 'Trạch Thiên Quải',
            '010111': 'Thủy Thiên Nhu',
            '010000': 'Thủy Địa Tỷ'
        };

        function flipCoins() {
            const coins = document.querySelectorAll('.coin img');
            const results = [];
            coins.forEach(coin => {
                coin.parentElement.classList.add('flip');
                const isHeads = Math.random() > 0.5;
                results.push(isHeads ? 'duong' : 'am');
                setTimeout(() => {
                    coin.src = isHeads ? headsImage : tailsImage;
                    coin.parentElement.classList.remove('flip');
                }, 3000);
            });
            return results;
        }

        function gieoQue() {
            const suViec = document.getElementById('su_viec').value;
            const ketQuaDiv = document.getElementById('ket_qua');
            const tenQueDiv = document.getElementById('ten_que');
            ketQuaDiv.innerHTML = `<p>Sự việc: ${suViec || 'Không nhập'}</p>`;
            tenQueDiv.innerHTML = '';

            const lines = [];
            const dongHao = [];
            let haoIndex = 0;

            // Tạo sẵn 6 hào trống
            for (let i = 6; i >= 1; i--) {
                const haoDiv = document.createElement('div');
                haoDiv.className = 'hao';
                haoDiv.id = `hao${i}`;
                haoDiv.innerHTML = `Hào ${i}: `;
                ketQuaDiv.appendChild(haoDiv);
            }

            function tungHao() {
                if (haoIndex < 6) {
                    const coinResults = flipCoins();
                    const sum = coinResults.filter(result => result === 'duong').length;
                    let haoType, haoDisplay, isDong;
                    if (sum === 0) {
                        haoType = 'am';
                        haoDisplay = '— — (âm, động)';
                        isDong = true;
                    } else if (sum === 1) {
                        haoType = 'am';
                        haoDisplay = '— — (âm)';
                        isDong = false;
                    } else if (sum === 2) {
                        haoType = 'duong';
                        haoDisplay = '————— (dương)';
                        isDong = false;
                    } else {
                        haoType = 'duong';
                        haoDisplay = '——o—— (dương, động)';
                        isDong = true;
                    }
                    lines.push(haoType); // Thêm hào từ hào 1 đến hào 6

                    // Gán số hào từ 1 đến 6 theo thứ tự lấy
                    if (isDong) dongHao.push(haoIndex + 1);

                    // Cập nhật hào tương ứng với màu đỏ nếu là hào động
                    const haoToUpdate = document.getElementById(`hao${haoIndex + 1}`);
                    haoToUpdate.innerHTML = `Hào ${haoIndex + 1}: ${haoDisplay}`;
                    if (isDong) {
                        haoToUpdate.classList.add('hao-dong');
                    } else {
                        haoToUpdate.classList.remove('hao-dong'); // Xóa lớp nếu không động
                    }

                    haoIndex++;
                    setTimeout(tungHao, 9000); // Tăng thời gian lên 9 giây
                } else {
                    // Tính quẻ và hiển thị ngay lập tức sau khi hào 6 được lấy
                    const binaryLines = lines.reverse().map(line => line === 'duong' ? '1' : '0');
                    const thuongQuai = [binaryLines[0], binaryLines[1], binaryLines[2]].join(''); // Hào 6, 5, 4
                    const haQuai = [binaryLines[3], binaryLines[4], binaryLines[5]].join(''); // Hào 3, 2, 1
                    const queKepCode = thuongQuai + haQuai;

                    const tenThuongQuai = queDon[thuongQuai] || 'Không xác định';
                    const tenHaQuai = queDon[haQuai] || 'Không xác định';
                    const tenQueKep = queKep[queKepCode] || 'Không xác định';

                    // Hiển thị tên quẻ và hào động ngay lập tức
                    let displayText = `Quẻ: ${tenQueKep} (Thượng: ${tenThuongQuai}, Hạ: ${tenHaQuai})`;
                    if (dongHao.length > 0) {
                        displayText += `, động hào ${dongHao.sort((a, b) => a - b).join(', ')}`;
                    } else {
                        displayText += ', không có hào động';
                    }
                    tenQueDiv.innerHTML = displayText;
                }
            }

            // Bắt đầu tung hào đầu tiên (hào 1)
            tungHao();
        }

        // Tự động tung xu khi tải trang
        setInterval(flipCoins, 9000);
    </script>
</body>
</html>