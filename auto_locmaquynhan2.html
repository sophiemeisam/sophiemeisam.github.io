<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tra Cứu Thần Sát & Phi Tinh Cửu Cung</title>
    <style>
        :root {
            --bg-body: #f4f4f9;
            --bg-card: #ffffff;
            --primary: #b22222;
            --gold: #d4af37;
            --text: #333;
            --success: #27ae60;
            --color-kham: #1e88e5;    /* Thủy */
            --color-kim: #ffdb58;     /* Kim */
            --color-tho: #8d6e63;     /* Thổ */
            --color-moc: #43a047;     /* Mộc */
            --color-hoa: #e91e63;     /* Hỏa */
            --color-trung: #d4a373;   /* Trung cung */
        }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg-body); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .section-container { background: var(--bg-card); padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); max-width: 550px; width: 100%; margin-bottom: 30px; }
        h2 { color: var(--primary); text-align: center; text-transform: uppercase; border-bottom: 2px solid var(--gold); padding-bottom: 10px; font-size: 1.2rem; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; background: #fff; font-size: 14px; cursor: pointer; }
        button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; }
        button:hover { background: #8b0000; transform: translateY(-2px); }
        #resultA { margin-top: 20px; padding: 15px; border-radius: 8px; background: #fff9e6; display: none; border: 1px solid var(--gold); }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .cell { aspect-ratio: 1/1; border-radius: 8px; display: flex; flex-direction: column; align-items: center; padding: 4px; position: relative; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
        
        /* Màu cung */
        #cell1 { background: var(--color-kham); } #cell2 { background: var(--color-tho); }
        #cell3 { background: var(--color-moc); } #cell4 { background: var(--color-moc); }
        #cell5 { background: var(--color-trung); border: 2px solid var(--gold); }
        #cell6 { background: var(--color-kim); color: #333; text-shadow: none; }
        #cell7 { background: var(--color-kim); color: #333; text-shadow: none; }
        #cell8 { background: var(--color-tho); } #cell9 { background: var(--color-hoa); }

        .cell-num { font-weight: bold; opacity: 0.8; font-size: 12px; position: absolute; top: 2px; left: 4px; }
        .cell-name { font-size: 10px; margin-top: 14px; font-weight: bold; text-transform: uppercase; }
        .cell-content { display: flex; flex-direction: column; gap: 3px; width: 100%; align-items: center; margin-top: 4px; overflow-y: auto; }
        .tag { font-size: 10px; font-weight: bold; padding: 2px 4px; border-radius: 4px; width: 85%; text-align: center; background: rgba(255,255,255,0.95); color: #b22222; border: 1px solid #ddd; text-shadow: none; box-shadow: 1px 1px 3px rgba(0,0,0,0.1); }

        /* Sắp xếp vị trí cung */
        #cell4 { grid-area: 1/1; } #cell9 { grid-area: 1/2; } #cell2 { grid-area: 1/3; }
        #cell3 { grid-area: 2/1; } #cell5 { grid-area: 2/2; } #cell7 { grid-area: 2/3; }
        #cell8 { grid-area: 3/1; } #cell1 { grid-area: 3/2; } #cell6 { grid-area: 3/3; }

        .form-area-B { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .full-width { grid-column: span 2; }
        .result-panel-B { margin-top: 15px; padding: 12px; background: #f9f9f9; border-radius: 8px; border: 1px solid #eee; font-size: 13px; line-height: 1.6; color: #555; }
        .highlight { color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

<div class="section-container">
    <h2>1. Nhập Tuổi / Thiên Can Chủ</h2>
    <div class="form-group">
        <label>Thiên Can Năm (hoặc Ngày):</label>
        <select id="canA">
            <option value="Giáp">Giáp</option><option value="Ất">Ất</option>
            <option value="Bính">Bính</option><option value="Đinh">Đinh</option>
            <option value="Mậu">Mậu</option><option value="Kỷ">Kỷ</option>
            <option value="Canh">Canh</option><option value="Tân">Tân</option>
            <option value="Nhâm">Nhâm</option><option value="Quý">Quý</option>
        </select>
    </div>
    <div class="form-group">
        <label>Địa Chi Năm (hoặc Ngày):</label>
        <select id="chiA">
            <option value="Tý">Tý</option><option value="Sửu">Sửu</option>
            <option value="Dần">Dần</option><option value="Mão">Mão</option>
            <option value="Thìn">Thìn</option><option value="Tỵ">Tỵ</option>
            <option value="Ngọ">Ngọ</option><option value="Mùi">Mùi</option>
            <option value="Thân">Thân</option><option value="Dậu">Dậu</option>
            <option value="Tuất">Tuất</option><option value="Hợi">Hợi</option>
        </select>
    </div>
    <button onclick="calculateA()">XÁC ĐỊNH & TÍNH PHI TINH</button>
    <div id="resultA"></div>
</div>

<div class="section-container">
    <h2>2. Vị Trí Thần Sát Đáo Cung</h2>
    <div class="grid">
        <div class="cell" id="cell4"><span class="cell-num">4</span><span class="cell-name">Tốn-ĐN</span><div class="cell-content" id="cont4"></div></div>
        <div class="cell" id="cell9"><span class="cell-num">9</span><span class="cell-name">Ly-Nam</span><div class="cell-content" id="cont9"></div></div>
        <div class="cell" id="cell2"><span class="cell-num">2</span><span class="cell-name">Khôn-TN</span><div class="cell-content" id="cont2"></div></div>
        <div class="cell" id="cell3"><span class="cell-num">3</span><span class="cell-name">Chấn-Đ</span><div class="cell-content" id="cont3"></div></div>
        <div class="cell" id="cell5"><span class="cell-num">5</span><span class="cell-name">Trung Cung</span><div class="cell-content" id="cont5"></div></div>
        <div class="cell" id="cell7"><span class="cell-num">7</span><span class="cell-name">Đoài-T</span><div class="cell-content" id="cont7"></div></div>
        <div class="cell" id="cell8"><span class="cell-num">8</span><span class="cell-name">Cấn-ĐB</span><div class="cell-content" id="cont8"></div></div>
        <div class="cell" id="cell1"><span class="cell-num">1</span><span class="cell-name">Khảm-B</span><div class="cell-content" id="cont1"></div></div>
        <div class="cell" id="cell6"><span class="cell-num">6</span><span class="cell-name">Càn-TB</span><div class="cell-content" id="cont6"></div></div>
    </div>

    <div class="form-area-B">
        <div class="form-group full-width">
            <label>Nạp Trung Cung (Ngày/Tháng hiện tại):</label>
            <select id="selB_A" onchange="runB()"></select>
        </div>
        <div class="form-group"><label>Lộc:</label><select id="selB_B" onchange="runB()"></select></div>
        <div class="form-group"><label>Mã:</label><select id="selB_C" onchange="runB()"></select></div>
        <div class="form-group"><label>Dương Quý:</label><select id="selB_D" onchange="runB()"></select></div>
        <div class="form-group"><label>Âm Quý:</label><select id="selB_E" onchange="runB()"></select></div>
    </div>
    <div class="result-panel-B" id="msgB"></div>
</div>

<script>
    const hoaGiap = ["Giáp Tý","Ất Sửu","Bính Dần","Đinh Mão","Mậu Thìn","Kỷ Tị","Canh Ngọ","Tân Mùi","Nhâm Thân","Quý Dậu","Giáp Tuất","Ất Hợi","Bính Tý","Đinh Sửu","Mậu Dần","Kỷ Mão","Canh Thìn","Tân Tị","Nhâm Ngọ","Quý Mùi","Giáp Thân","Ất Dậu","Bính Tuất","Đinh Hợi","Mậu Tý","Kỷ Sửu","Canh Dần","Tân Mão","Nhâm Thìn","Quý Tị","Giáp Ngọ","Ất Mùi","Bính Thân","Đinh Dậu","Mậu Tuất","Kỷ Hợi","Canh Tý","Tân Sửu","Nhâm Dần","Quý Mão","Giáp Thìn","Ất Tị","Bính Ngọ","Đinh Mùi","Mậu Thân","Kỷ Dậu","Canh Tuất","Tân Hợi","Nhâm Tý","Quý Sửu","Giáp Dần","Ất Mão","Bính Thìn","Đinh Tị","Mậu Ngọ","Kỷ Mùi","Canh Thân","Tân Dậu","Nhâm Tuất","Quý Hợi"];
    const dataLoc = {"Giáp":"Dần","Ất":"Mão","Bính":"Tỵ","Đinh":"Ngọ","Mậu":"Tỵ","Kỷ":"Ngọ","Canh":"Thân","Tân":"Dậu","Nhâm":"Hợi","Quý":"Tý"};
    const dataMa = {"Tý":"Dần","Sửu":"Hợi","Dần":"Thân","Mão":"Tỵ","Thìn":"Dần","Tỵ":"Hợi","Ngọ":"Thân","Mùi":"Tỵ","Thân":"Dần","Dậu":"Hợi","Tuất":"Thân","Hợi":"Tỵ"};
    const dataQN = {"Giáp":{am:"Sửu",duong:"Mùi"},"Ất":{am:"Tý",duong:"Thân"},"Bính":{am:"Hợi",duong:"Dậu"},"Đinh":{am:"Dậu",duong:"Hợi"},"Mậu":{am:"Mùi",duong:"Sửu"},"Kỷ":{am:"Thân",duong:"Tý"},"Canh":{am:"Mùi",duong:"Sửu"},"Tân":{am:"Ngọ",duong:"Dần"},"Nhâm":{am:"Tỵ",duong:"Mão"},"Quý":{am:"Mão",duong:"Tỵ"}};
    const luongThienXich = [5, 6, 7, 8, 9, 1, 2, 3, 4];
    const cungNames = {1:"Khảm (Bắc)", 2:"Khôn (Tây Nam)", 3:"Chấn (Đông)", 4:"Tốn (Đông Nam)", 5:"Trung Cung", 6:"Càn (Tây Bắc)", 7:"Đoài (Tây)", 8:"Cấn (Đông Bắc)", 9:"Ly (Nam)"};

    function getNguHoDon(canNam, chiMucTieu) {
        const cans = ["Giáp","Ất","Bính","Đinh","Mậu","Kỷ","Canh","Tân","Nhâm","Quý"];
        const chis = ["Dần","Mão","Thìn","Tỵ","Ngọ","Mùi","Thân","Dậu","Tuất","Hợi","Tý","Sửu"];
        let startIdx = ["Giáp","Kỷ"].includes(canNam)?2:["Ất","Canh"].includes(canNam)?4:["Bính","Tân"].includes(canNam)?6:["Đinh","Nhâm"].includes(canNam)?8:0;
        return cans[(startIdx + chis.indexOf(chiMucTieu)) % 10];
    }

    function calculateA() {
        const can = document.getElementById("canA").value;
        const chi = document.getElementById("chiA").value;
        const loc = `${getNguHoDon(can, dataLoc[can])} ${dataLoc[can]}`;
        const ma = `${getNguHoDon(can, dataMa[chi])} ${dataMa[chi]}`;
        const dQn = `${getNguHoDon(can, dataQN[can].duong)} ${dataQN[can].duong}`;
        const aQn = `${getNguHoDon(can, dataQN[can].am)} ${dataQN[can].am}`;

        document.getElementById("resultA").style.display = "block";
        document.getElementById("resultA").innerHTML = `<b>Kết quả:</b> Lộc (${loc}), Mã (${ma}), Dương Quý (${dQn}), Âm Quý (${aQn})`;

        // Tự động điền xuống phần 2
        document.getElementById('selB_B').value = loc;
        document.getElementById('selB_C').value = ma;
        document.getElementById('selB_D').value = dQn;
        document.getElementById('selB_E').value = aQn;
        
        runB(); // Chạy phi tinh ngay
    }

    function initB() {
        ['selB_A', 'selB_B', 'selB_C', 'selB_D', 'selB_E'].forEach(id => {
            const el = document.getElementById(id);
            hoaGiap.forEach(item => { el.add(new Option(item, item)); });
        });
        document.getElementById('selB_A').value = "Giáp Tý";
        calculateA(); 
    }

    function runB() {
        for(let i=1; i<=9; i++) document.getElementById('cont' + i).innerHTML = "";
        const gA = document.getElementById('selB_A').value;
        const targets = [
            {v:document.getElementById('selB_B').value, n:'Lộc'},
            {v:document.getElementById('selB_C').value, n:'Mã'},
            {v:document.getElementById('selB_D').value, n:'Dương Quý'},
            {v:document.getElementById('selB_E').value, n:'Âm Quý'}
        ];
        
        document.getElementById('cont5').innerHTML = `<div class="tag" style="background:#fff; color:#333">Trung: ${gA}</div>`;
        let log = `Khi nạp <span class="highlight">${gA}</span> vào Trung Cung:<br>`;
        
        targets.forEach(t => {
            const cungNum = luongThienXich[(hoaGiap.indexOf(t.v) - hoaGiap.indexOf(gA) + 60) % 60 % 9];
            document.getElementById('cont' + cungNum).innerHTML += `<div class="tag">${t.n}</div>`;
            log += `• <span class="highlight">${t.n}</span> (${t.v}) đang đóng tại <span class="highlight">${cungNames[cungNum]}</span><br>`;
        });
        document.getElementById('msgB').innerHTML = log;
    }

    window.onload = initB;
</script>
</body>
</html>
