<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>B√†i Tr√† Ti√™n Tri - Ho√†n ch·ªânh</title>
<style>
    body{font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",sans-serif;margin:0;background:#f0f0f5;color:#1c1c1e;padding-bottom:60px}
    .container{max-width:800px;margin:0 auto;background:#fff;min-height:100vh;box-shadow:0 0 10px rgba(0,0,0,0.05)}
    .header-bar{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;padding:15px 20px;border-bottom:1px solid #e5e5ea;position:sticky;top:0;background:#fff;z-index:10}
    .back-link{text-decoration:none;color:#007aff;font-size:18px;font-weight:600;display:flex;align-items:center;justify-self:start}
    .back-link:before{content:'‚Äπ';font-size:28px;margin-right:6px}
    h1{margin:0;font-size:18px;font-weight:600;text-align:center}
    .content{padding:20px}
    .controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:18px}
    button{padding:12px;border:none;border-radius:10px;cursor:pointer;font-size:15px;font-weight:600;background:#007aff;color:#fff;box-shadow:0 2px 4px rgba(0,122,255,0.3);transition:transform .08s}
    button:active{transform:scale(.98)} button:disabled{background:#a0a0a0;cursor:not-allowed}
    #result{margin-top:14px;padding:14px;background:#f7f7f9;border-radius:12px;box-shadow:inset 0 1px 3px rgba(0,0,0,0.06);min-height:140px;opacity:0;transition:opacity .45s}
    .fade-in{opacity:1}
    .spread-title{font-size:1.2rem;font-weight:700;color:#2e7d32;text-align:center;margin-bottom:10px}
    .countdown-display{text-align:center;padding:18px 0;color:#007aff}
    .countdown-timer{font-size:3.2rem;font-weight:800;margin:4px 0}
    .countdown-instruction{font-size:1rem;color:#8e8e93;font-weight:500}
    .card-list{list-style:none;padding:0;margin:0}
    .card-list li{background:#fff;margin-bottom:8px;padding:10px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.08);border-left:4px solid #38761d;display:flex;gap:8px;align-items:center}
    .card-title{font-weight:700;color:#007aff;min-width:160px}
    .deck-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px}
    .deck-item{background:#fff;padding:8px;border-radius:6px;border-left:3px solid #ccc}
    .small{font-size:.9rem;color:#666}
    .actions-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
</style>
</head>
<body>
<div class="container">
    <div class="header-bar">
        <a href="#" class="back-link">V·ªÅ</a>
        <h1>B√†i Tr√† Ti√™n Tri ‚Äî Phi√™n b·∫£n ho√†n ch·ªânh</h1>
        <div></div>
    </div>

    <div class="content">
        <div class="controls">
            <button onclick="startCountdown(3,'T√¨nh H√¨nh Chung','performSpread')">Tr·∫£i B√†i 3 L√°</button>
            <button onclick="startCountdown(5,'Ph√¢n T√≠ch S√¢u S·∫Øc','performSpread')">Tr·∫£i B√†i 5 L√°</button>
            <button onclick="startCountdown(7,'Tr·∫£i B√†i Theo Tu·∫ßn','performWeeklySpread')">Tr·∫£i 7 Ng√†y</button>
            <button onclick="startCountdown(4,'Tr·∫£i B√†i Theo Th√°ng','performMonthlySpread')">Tr·∫£i 4 Tu·∫ßn</button>
            <button onclick="startCountdown(12,'Tr·∫£i B√†i Theo NƒÉm','performYearlySpread')">Tr·∫£i 12 Th√°ng</button>
            <button onclick="showFullDeck()">Xem to√†n b·ªô b·ªô b√†i (200 l√°)</button>
        </div>

        <div id="result">
            <p style="text-align:center;color:#8e8e93;">Ch·ªçn ki·ªÉu tr·∫£i b√†i, t·∫≠p trung trong 10 gi√¢y r·ªìi nh·∫≠n th√¥ng ƒëi·ªáp.</p>
        </div>
    </div>
</div>

<script>
/* ---------- D·ªÆ LI·ªÜU: ƒë·∫ßy ƒë·ªß 200+ t√™n (theo danh s√°ch b·∫°n ƒë√£ cung c·∫•p) ---------- */
const ALL_CARDS = [
"Angel - Ti√™n n·ªØ","Ant - Con ki·∫øn","Apple - Qu·∫£ t√°o","Archway - C·ªïng v√≤m","Arrow - M≈©i t√™n",
"Axe - C√¢y r√¨u","Bag - T√∫i","Barrel - Th√πng R·ªóng","Basket - Gi·ªè r∆°m","Bat - Con d∆°i",
"Bear - Con g·∫•u","Beetle - B·ªç c√°nh c·ª©ng","Bell - C√°i chu√¥ng","Bird Flying - Chim bay","Bird Perched - Chim ƒë·∫≠u",
"Boat - Con thuy·ªÅn","Boot - Chi·∫øc ·ªßng","Bouquet - B√≥ hoa","Bow - C√°i n∆°","Bowl - C√°i ch·∫≠u",
"Box - C√°i h·ªôp","Bread - B√°nh m√¨","Bridge - C√¢y c·∫ßu","Broken Bridge - C·∫ßu g√£y","Broken Ring - Chia ly, ch·∫•m d·ª©t",
"Broken Wishbone - X∆∞∆°ng ƒë√≤n b·ªã g√£y","Broom - C√¢y ch·ªïi","Bull - B√≤ ƒë·ª±c","Butterfly - Con b∆∞·ªõm","Camel - Con l·∫°c ƒë√†",
"Candle - Ng·ªçn n·∫øn","Cane - G·∫≠y ch·ªëng, batoong","Carriage - C·ªó xe th√πng","Carrot - C·ªß c√† r·ªët","Casket - Quan t√†i",
"Cat - Con m√®o","Caterpillar - Con s√¢u","Chain - S·ª£i d√¢y x√≠ch","Chair Empty - Chi·∫øc gh·∫ø tr·ªëng","Chair Filled - Ng∆∞·ªùi ng·ªìi gh·∫ø",
"Claw - M√≥ng vu·ªët","Clouds - ƒê√°m m√¢y","Club - C√¢y ch√πy","Cobweb - M·∫°ng nh·ªán","Coins - Ti·ªÅn xu",
"Cracked Cup - C·ªëc v·ª°","Crib - C√°i n√¥i","Crown - V∆∞∆°ng mi·ªán","Cup - C√°i t√°ch","Dagger - Dao gƒÉm",
"Dark Man - Ng∆∞·ªùi ƒë√†n √¥ng m√†u ƒëen","Dark Woman - Ng∆∞·ªùi ph·ª• n·ªØ m√†u ƒëen","Desk - C√°i b√†n","Diamond - Kim c∆∞∆°ng","Dog - 1 ch√∫ ch√≥",
"Dogs - 2 ch√∫ ch√≥","Dog Barking - Ch√≥ s·ªßa","Dog Close Up - Ch√≥ vui v·∫ª","Dog Far Away - Ch√∫ ch√≥ bu·ªìn b√£","Dolphin - C√° heo",
"Door - C√°nh c·ª≠a","Dragon - Con r·ªìng","Eagle - Con chim ∆∞ng","Ear - C√°i tai","Egg - Qu·∫£ tr·ª©ng",
"Elephant - Con voi","Eye - Con m·∫Øt","Fair Man - Ng∆∞·ªùi ƒë√†n √¥ng s√°ng m√†u","Fair Woman - Ng∆∞·ªùi ph·ª• n·ªØ s√°ng m√†u","Fan - Qu·∫°t",
"Feather - L√¥ng v≈©","Finger - Ng√≥n tay","Fire - Ng·ªçn l·ª≠a","Firecracker - Ph√°o hoa n·ªï","Flag - L√° c·ªù",
"Flowers - Hoa n·ªü","Flute - √îng s√°o","Fly - Con ru·ªìi","Forest - Khu r·ª´ng","Four Leaf Clover - C·ªè 4 l√°",
"Fox - Con c√°o","Frying Pan - C√°i ch·∫£o","Funnel - C√°i ph·ªÖu","Gavel - C√°i b√∫a","Gong - C√°i chi√™ng",
"Goldfish - C√° v√†ng","Grapes - Ch√πm nho","Grasshopper - Con c√†o c√†o","Hammock - C√°i v√µng","Hand - B√†n tay",
"Handshake - B·∫Øt tay","Harp - ƒê√†n h·∫°c","Hat - C√°i m≈©","Haystack - R∆°m c·ªè kh√¥","Heart - Tr√°i tim",
"Hills - Ng·ªçn ƒë·ªìi","Horse - Con ng·ª±a","Horseshoe - M√≥ng ng·ª±a","Inkpot - B√¨nh m·ª±c","Jug - C√°i b√¨nh",
"Kangaroo - Chu·ªôt t√∫i","Key - Ch√¨a kh√≥a","Kite - Con di·ªÅu","Knot - N√∫t th·∫Øt","Ladder - B·∫≠c thang",
"Leg - Ch√¢n","Lightning - Tia ch·ªõp","Lily - Hoa lily","Lion - S∆∞ t·ª≠","Lobster - Con t√¥m",
"Man - Ng∆∞·ªùi ƒë√†n √¥ng","Mice - Con chu·ªôt","Money Path - Con ƒë∆∞·ªùng ti·ªÅn","Moon - M·∫∑t trƒÉng","Mountain - Ng·ªçn n√∫i",
"Mountain Road - ƒê∆∞·ªùng l√™n n√∫i","Mule - Con l·ª´a","Needle & Thread - Kim ch·ªâ","Nest - T·ªï chim","Older Man - Ng∆∞·ªùi ƒë√†n √¥ng l·ªõn tu·ªïi",
"Older Woman - Ng∆∞·ªùi ph·ª• n·ªØ l·ªõn tu·ªïi","Owl - Con c√∫","Pail - Th√πng n∆∞·ªõc","Parrot - Con v·∫πt","Peacock - Con c√¥ng",
"Pig - Con l·ª£n","Pin - ƒêinh ghim","Pineapple - Qu·∫£ d·ª©a","Purse - T√∫i ti·ªÅn","Quill - B√∫t l√¥ng ng·ªóng",
"Rabbit - Con th·ªè","Rainbow - C·∫ßu v·ªìng","Ram - C·ª´u ƒë·ª±c","Rat - Chu·ªôt ƒë·ªìng","Ring - Chi·∫øc nh·∫´n",
"Rooster - G√† tr·ªëng","Rose - Hoa h·ªìng","Scales - C√°n c√¢n","Scissors - C·∫Øt ƒë·ª©t m·ªëi quan h·ªá","Sea Horse - C√° ng·ª±a",
"Shark - C√° m·∫≠p","Shield - C√°i khi√™n","Skull - ƒê·∫ßu l√¢u","Spear - Ng·ªçn gi√°o","Staff - H·ªó tr·ª£, ch·ªâ d·∫´n",
"Star - Ng√¥i sao","Stork - Con c√≤","Sun - M·∫∑t tr·ªùi","Sunrise - B√¨nh minh","Table - C√°i b√†n",
"Tankard - C·ªëc v·∫°i","Target - Bia b·∫Øn","Teapot - B√¨nh tr√†","Teardrops - Gi·ªçt n∆∞·ªõc m·∫Øt","Tent - C√°i l·ªÅu",
"Throne - Ngai v√†ng","Tiger - Con h·ªï","Torch - Ng·ªçn ƒëu·ªëc","Tortoise - Con r√πa","Tower - To√† th√°p",
"Tree - C√¢y","Tulip - Hoa tulip","Turkey - G√† t√¢y","Unicorn - K·ª≥ l√¢n","V - Ch·ªØ V",
"Valley - Thung l≈©ng","Vase - L·ªç hoa","Vine - C√†nh nho xanh","Vulture - Con k·ªÅn k·ªÅn","Wall - B·ª©c t∆∞·ªùng",
"Wedge - C√°i n√™m","Weeping Willow - C√¢y d∆∞∆°ng li·ªÖu","Well - C√°i gi·∫øng","Whale - C√° voi","Wheel - B√°nh xe",
"Windchimes - Chu√¥ng gi√≥","Wishbone - X∆∞∆°ng ƒë√≤n","Woman - Ng∆∞·ªùi ph·ª• n·ªØ","Wreath - V√≤ng hoa","Yoke - S·ª± r√†ng bu·ªôc",
"Younger Man - Ng∆∞·ªùi ƒë√†n √¥ng tr·∫ª tu·ªïi","Younger Woman - Ng∆∞·ªùi ph·ª• n·ªØ tr·∫ª tu·ªïi",
"January - Th√°ng 1","February - Th√°ng 2","March - Th√°ng 3","April - Th√°ng 4","May - Th√°ng 5","June - Th√°ng 6",
"July - Th√°ng 7","August - Th√°ng 8","September - Th√°ng 9","October - Th√°ng 10","November - Th√°ng 11","December - Th√°ng 12",
"Career - S·ª± nghi·ªáp","Marriage - H√¥n nh√¢n","Happiness - H·∫°nh Ph√∫c","Love - T√¨nh y√™u","Success - Th√†nh c√¥ng","Wealth - T√†i ch√≠nh"
];

/* ---------- H·ªñ TR·ª¢ NG·∫™U NHI√äN B·∫¢O M·∫¨T ---------- */
function secureRandom(max){
    if (window.crypto && window.crypto.getRandomValues) {
        const arr = new Uint32Array(1);
        window.crypto.getRandomValues(arr);
        return arr[0] % max;
    }
    return Math.floor(Math.random()*max);
}

/* R√∫t unique */
function drawUniqueCards(count, deck){
    const drawn = [];
    const available = Array.from(Array(deck.length).keys());
    for (let i=0;i<count;i++){
        if (available.length===0) break;
        const idx = secureRandom(available.length);
        drawn.push(deck[available[idx]]);
        available.splice(idx,1);
    }
    return drawn;
}

/* ƒê·∫øm ng∆∞·ª£c v√† g·ªçi tr·∫£i b√†i */
function startCountdown(count,title,fnName){
    let timer=10;
    const res = document.getElementById('result');
    const btns = document.querySelectorAll('.controls button, .controls button');
    btns.forEach(b=>b.disabled=true);
    res.classList.remove('fade-in');
    res.innerHTML = `<div class="countdown-display">
        <p class="countdown-instruction">T·∫≠p trung v√† nghƒ© v·ªÅ v·∫•n ƒë·ªÅ c·ªßa b·∫°n...</p>
        <div class="countdown-timer" id="countdown-timer">${timer}</div>
        <p class="countdown-instruction">Gi√¢y</p>
    </div>`;
    const interval = setInterval(()=>{
        timer--;
        const el = document.getElementById('countdown-timer');
        if (el) el.textContent = timer;
        if (timer<=0){
            clearInterval(interval);
            if (fnName==='performSpread') performSpread(count,title);
            else if (fnName==='performWeeklySpread') performWeeklySpread();
            else if (fnName==='performMonthlySpread') performMonthlySpread();
            else if (fnName==='performYearlySpread') performYearlySpread();
            btns.forEach(b=>b.disabled=false);
        }
    },1000);
}

/* C√°c ki·ªÉu tr·∫£i b√†i */
function performSpread(count,title){
    const cards = drawUniqueCards(count, ALL_CARDS);
    displayResults(title,cards);
}
function performWeeklySpread(){
    const days = ["Th·ª© Hai","Th·ª© Ba","Th·ª© T∆∞","Th·ª© NƒÉm","Th·ª© S√°u","Th·ª© B·∫£y","Ch·ªß Nh·∫≠t"];
    const cards = drawUniqueCards(7,ALL_CARDS);
    let html = `<div class="spread-title">Tr·∫£i B√†i Theo Tu·∫ßn</div><ul class="card-list">`;
    cards.forEach((c,i)=> html += `<li><span class="card-title">${days[i]}:</span> ${c}</li>`);
    html += `</ul>`;
    showResult(html);
}
function performMonthlySpread(){
    const weeks = ["Tu·∫ßn 1 (ƒê·∫ßu th√°ng)","Tu·∫ßn 2","Tu·∫ßn 3","Tu·∫ßn 4 (Cu·ªëi th√°ng)"];
    const cards = drawUniqueCards(4,ALL_CARDS);
    let html = `<div class="spread-title">Tr·∫£i B√†i Theo Th√°ng</div><ul class="card-list">`;
    cards.forEach((c,i)=> html += `<li><span class="card-title">${weeks[i]}:</span> ${c}</li>`);
    html += `</ul>`;
    showResult(html);
}
function performYearlySpread(){
    const months = ["Th√°ng 1","Th√°ng 2","Th√°ng 3","Th√°ng 4","Th√°ng 5","Th√°ng 6","Th√°ng 7","Th√°ng 8","Th√°ng 9","Th√°ng 10","Th√°ng 11","Th√°ng 12"];
    const cards = drawUniqueCards(12,ALL_CARDS);
    let html = `<div class="spread-title">Tr·∫£i B√†i Theo NƒÉm</div><ul class="card-list">`;
    cards.forEach((c,i)=> html += `<li><span class="card-title">${months[i]}:</span> ${c}</li>`);
    html += `</ul>`;
    showResult(html);
}

/* Hi·ªÉn th·ªã k·∫øt qu·∫£ chung */
function displayResults(title,cards){
    const pos = {
        3: ["L√° 1: Qu√° kh·ª© / G·ªëc r·ªÖ","L√° 2: Hi·ªán t·∫°i / T√¨nh h√¨nh","L√° 3: T∆∞∆°ng lai / Ti·ªÅm nƒÉng"],
        5: ["L√° 1: T√¨nh hu·ªëng c·ªët l√µi","L√° 2: Th√°ch th·ª©c","L√° 3: L·ªùi khuy√™n","L√° 4: ·∫¢nh h∆∞·ªüng t·ª´ b√™n ngo√†i","L√° 5: K·∫øt qu·∫£ cu·ªëi c√πng"]
    };
    let html = `<div class="spread-title">${title}</div><ul class="card-list">`;
    cards.forEach((c,i)=>{
        const label = pos[cards.length] ? pos[cards.length][i] : `L√° ${i+1}`;
        html += `<li><span class="card-title">${label}:</span> ${c}</li>`;
    });
    html += `</ul>`;
    showResult(html);
}

/* Hi·ªÉn th·ªã k·∫øt qu·∫£ cu·ªëi */
function showResult(html){
    const res = document.getElementById('result');
    res.innerHTML = html + `<div class="actions-row" style="justify-content:center"><button onclick="redoLast()">üîÅ R√∫t l·∫°i (m·ªõi) </button><button onclick="showFullDeck()">üìö Xem b·ªô b√†i</button></div>`;
    setTimeout(()=>res.classList.add('fade-in'),40);
}

/* R√∫t l·∫°i (kh·ªüi 1 l∆∞·ª£t r√∫t m·ªõi, reset trang) */
function redoLast(){
    // c√°ch ƒë∆°n gi·∫£n: reload trang ƒë·ªÉ reset ng·∫´u nhi√™n; ho·∫∑c c√≥ th·ªÉ g·ªçi startCountdown v·ªõi bi·∫øn l∆∞u lastSpread n·∫øu mu·ªën
    location.reload();
}

/* Hi·ªÉn th·ªã to√†n b·ªô deck theo th·ª© t·ª± g·ªëc */
function showFullDeck(){
    const res = document.getElementById('result');
    let html = `<div class="spread-title">To√†n b·ªô b·ªô b√†i (theo th·ª© t·ª± danh s√°ch)</div><div class="deck-grid">`;
    ALL_CARDS.forEach((c,i)=> html += `<div class="deck-item"><strong>${i+1}.</strong> ${c}</div>`);
    html += `</div><p class="small" style="margin-top:12px">S·ªë l√°: ${ALL_CARDS.length}. ƒê√¢y l√† th·ª© t·ª± nguy√™n b·∫£n trong m·∫£ng ALL_CARDS.</p>`;
    res.innerHTML = html + `<div class="actions-row" style="margin-top:12px"><button onclick="location.reload()">ƒê√≥ng</button></div>`;
    setTimeout(()=>res.classList.add('fade-in'),40);
}
</script>
</body>
</html>