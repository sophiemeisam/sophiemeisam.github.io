<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>B√†i Tr√† Ti√™n Tri</title>
<style>
    body{font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",sans-serif;margin:0;background:#f0f0f5;color:#111;padding-bottom:60px}
    .container{max-width:900px;margin:0 auto;background:#fff;min-height:100vh;box-shadow:0 0 12px rgba(0,0,0,0.06)}
    .header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid #e9e9ef;position:sticky;top:0;background:#fff;z-index:10}
    .title{font-weight:700}
    .content{padding:18px}
    .controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:14px}
    button{padding:12px;border:none;border-radius:10px;background:#007aff;color:#fff;font-weight:700;cursor:pointer;box-shadow:0 2px 6px rgba(0,122,255,0.2)}
    button:disabled{background:#9aa3ad;cursor:not-allowed}
    #result{margin-top:12px;padding:14px;background:#f7f7f9;border-radius:10px;min-height:160px;box-shadow:inset 0 1px 3px rgba(0,0,0,0.04);transition:opacity .35s;opacity:1}
    .spread-title{font-size:1.15rem;font-weight:700;color:#2e7d32;text-align:center;margin-bottom:8px}
    .card-list{list-style:none;padding:0;margin:0}
    .card-list li{background:#fff;margin:8px 0;padding:10px;border-radius:8px;border-left:4px solid #38761d;display:flex;gap:10px;align-items:center}
    .card-title{min-width:150px;font-weight:700;color:#007aff}
    .deck-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px}
    .deck-item{background:#fff;padding:8px;border-radius:6px;border-left:3px solid #ccc}
    .actions{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
    .small{font-size:.92rem;color:#666}
    .error{color:#a33;background:#ffecec;padding:8px;border-radius:6px;margin-top:10px}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="title">B√†i Tr√† Ti√™n Tri</div>
        <div><small class="small"></small></div>
    </div>

    <div class="content">
        <div class="controls">
            <button id="btn-3">Tr·∫£i B√†i 3 L√°</button>
            <button id="btn-5">Tr·∫£i B√†i 5 L√°</button>
            <button id="btn-7">Tr·∫£i 7 Ng√†y</button>
            <button id="btn-4">Tr·∫£i Theo Th√°ng (4)</button>
            <button id="btn-12">Tr·∫£i Theo NƒÉm (12)</button>
            <button id="btn-deck">Xem to√†n b·ªô b·ªô b√†i (200 l√°)</button>
        </div>

        <div id="result">
            <p style="text-align:center;color:#666">Ch·ªçn ki·ªÉu tr·∫£i b√†i, t·∫≠p trung trong 10 gi√¢y r·ªìi nh·∫≠n th√¥ng ƒëi·ªáp. N·∫øu c√≥ l·ªói, m√¨nh s·∫Ω show ·ªü ƒë√¢y.</p>
        </div>
    </div>
</div>

<script>
/*
  Phi√™n b·∫£n s·ª≠a l·ªói:
  - Th√™m ALL_CARDS ƒë·∫ßy ƒë·ªß
  - D√πng secureRandom v·ªõi fallback
  - B·∫Øt l·ªói (try/catch) v√† hi·ªÉn th·ªã l·ªói l√™n #result
  - ƒêƒÉng k√Ω s·ª± ki·ªán buttons b·∫±ng JS (kh√¥ng rely tr√™n inline onclick)
*/

/* ---------- D·ªÆ LI·ªÜU: ƒë·∫ßy ƒë·ªß 200+ t√™n (theo danh s√°ch b·∫°n ƒë√£ cung c·∫•p) ---------- */
const ALL_CARDS = [
"Angel - Ti√™n n·ªØ","Ant - Con ki·∫øn","Apple - Qu·∫£ t√°o","Archway - C·ªïng v√≤m","Arrow - M≈©i t√™n",
"Axe - C√¢y r√¨u","Bag - T√∫i","Barrel - Th√πng R·ªóng","Basket - Gi·ªè r∆°m","Bat - Con d∆°i",
"Bear - Con g·∫•u","Beetle - B·ªç c√°nh c·ª©ng","Bell - C√°i chu√¥ng","Bird Flying - Chim bay","Bird Perched - Chim ƒë·∫≠u",
"Boat - Con thuy·ªÅn","Boot - Chi·∫øc ·ªßng","Bouquet - B√≥ hoa","Bow - C√°i n∆°","Bowl - C√°i ch·∫≠u",
"Box - C√°i h·ªôp","Bread - B√°nh m√¨","Bridge - C√¢y c·∫ßu","Broken Bridge - C·∫ßu g√£y","Broken Ring - Chia ly, ch·∫•m d·ª©t",
"Broken Wishbone - X∆∞∆°ng ƒë√≤n b·ªã g√£y","Broom - C√¢y ch·ªïi","Bull - B√≤ ƒë·ª±c","Butterfly - Con b∆∞·ªõm","Camel - Con l·∫°c ƒë√†",
"Candle - Ng·ªçn n·∫øn","Cane - G·∫≠y ch·ªëng, batoong","Carriage - C·ªó xe th√πng","Carrot - C·ªß c√† r·ªët","Casket - Quan t√†i",
"Cat - Con m√®o","Caterpillar - Con s√¢u","Chain - S·ª£i d√¢y x√≠ch","Chair Empty - Chi·∫øc gh·∫ø tr·ªëng","Chair Filled - Ng∆∞·ªùi ng·ªìi gh·∫ø",
"Claw - M√≥ng vu·ªët","Clouds - ƒê√°m m√¢y","Club - C√¢y ch√πy","Cobweb - M·∫°ng nh·ªán","Coins - Ti·ªÅn xu",
"Cracked Cup - C·ªëc v·ª°","Crib - C√°i n√¥i","Crown - V∆∞∆°ng mi·ªán","Cup - C√°i t√°ch","Dagger - Dao gƒÉm",
"Dark Man - Ng∆∞·ªùi ƒë√†n √¥ng m√†u ƒëen","Dark Woman - Ng∆∞·ªùi ph·ª• n·ªØ m√†u ƒëen","Desk - C√°i b√†n","Diamond - Kim c∆∞∆°ng","Dog - 1 ch√∫ ch√≥",
"Dogs - 2 ch√∫ ch√≥","Dog Barking - Ch√≥ s·ªßa","Dog Close Up - Ch√≥ vui v·∫ª","Dog Far Away - Ch√∫ ch√≥ bu·ªìn b√£","Dolphin - C√° heo",
"Door - C√°nh c·ª≠a","Dragon - Con r·ªìng","Eagle - Con chim ∆∞ng","Ear - C√°i tai","Egg - Qu·∫£ tr·ª©ng",
"Elephant - Con voi","Eye - Con m·∫Øt","Fair Man - Ng∆∞·ªùi ƒë√†n √¥ng s√°ng m√†u","Fair Woman - Ng∆∞·ªùi ph·ª• n·ªØ s√°ng m√†u","Fan - Qu·∫°t",
"Feather - L√¥ng v≈©","Finger - Ng√≥n tay","Fire - Ng·ªçn l·ª≠a","Firecracker - Ph√°o hoa n·ªï","Flag - L√° c·ªù",
"Flowers - Hoa n·ªü","Flute - √îng s√°o","Fly - Con ru·ªìi","Forest - Khu r·ª´ng","Four Leaf Clover - C·ªè 4 l√°",
"Fox - Con c√°o","Frying Pan - C√°i ch·∫£o","Funnel - C√°i ph·ªÖu","Gavel - C√°i b√∫a","Gong - C√°i chi√™ng",
"Goldfish - C√° v√†ng","Grapes - Ch√πm nho","Grasshopper - Con c√†o c√†o","Hammock - C√°i v√µng","Hand - B√†n tay",
"Handshake - B·∫Øt tay","Harp - ƒê√†n h·∫°c","Hat - C√°i m≈©","Haystack - R∆°m c·ªè kh√¥","Heart - Tr√°i tim",
"Hills - Ng·ªçn ƒë·ªìi","Horse - Con ng·ª±a","Horseshoe - M√≥ng ng·ª±a","Inkpot - B√¨nh m·ª±c","Jug - C√°i b√¨nh",
"Kangaroo - Chu·ªôt t√∫i","Key - Ch√¨a kh√≥a","Kite - Con di·ªÅu","Knot - N√∫t th·∫Øt","Ladder - B·∫≠c thang",
"Leg - Ch√¢n","Lightning - Tia ch·ªõp","Lily - Hoa lily","Lion - S∆∞ t·ª≠","Lobster - Con t√¥m",
"Man - Ng∆∞·ªùi ƒë√†n √¥ng","Mice - Con chu·ªôt","Money Path - Con ƒë∆∞·ªùng ti·ªÅn","Moon - M·∫∑t trƒÉng","Mountain - Ng·ªçn n√∫i",
"Mountain Road - ƒê∆∞·ªùng l√™n n√∫i","Mule - Con l·ª´a","Needle & Thread - Kim ch·ªâ","Nest - T·ªï chim","Older Man - Ng∆∞·ªùi ƒë√†n √¥ng l·ªõn tu·ªïi",
"Older Woman - Ng∆∞·ªùi ph·ª• n·ªØ l·ªõn tu·ªïi","Owl - Con c√∫","Pail - Th√πng n∆∞·ªõc","Parrot - Con v·∫πt","Peacock - Con c√¥ng",
"Pig - Con l·ª£n","Pin - ƒêinh ghim","Pineapple - Qu·∫£ d·ª©a","Purse - T√∫i ti·ªÅn","Quill - B√∫t l√¥ng ng·ªóng",
"Rabbit - Con th·ªè","Rainbow - C·∫ßu v·ªìng","Ram - C·ª´u ƒë·ª±c","Rat - Chu·ªôt ƒë·ªìng","Ring - Chi·∫øc nh·∫´n",
"Rooster - G√† tr·ªëng","Rose - Hoa h·ªìng","Scales - C√°n c√¢n","Scissors - C·∫Øt ƒë·ª©t m·ªëi quan h·ªá","Sea Horse - C√° ng·ª±a",
"Shark - C√° m·∫≠p","Shield - C√°i khi√™n","Skull - ƒê·∫ßu l√¢u","Spear - Ng·ªçn gi√°o","Staff - H·ªó tr·ª£, ch·ªâ d·∫´n",
"Star - Ng√¥i sao","Stork - Con c√≤","Sun - M·∫∑t tr·ªùi","Sunrise - B√¨nh minh","Table - C√°i b√†n",
"Tankard - C·ªëc v·∫°i","Target - Bia b·∫Øn","Teapot - B√¨nh tr√†","Teardrops - Gi·ªçt n∆∞·ªõc m·∫Øt","Tent - C√°i l·ªÅu",
"Throne - Ngai v√†ng","Tiger - Con h·ªï","Torch - Ng·ªçn ƒëu·ªëc","Tortoise - Con r√πa","Tower - To√† th√°p",
"Tree - C√¢y","Tulip - Hoa tulip","Turkey - G√† t√¢y","Unicorn - K·ª≥ l√¢n","V - Ch·ªØ V",
"Valley - Thung l≈©ng","Vase - L·ªç hoa","Vine - C√†nh nho xanh","Vulture - Con k·ªÅn k·ªÅn","Wall - B·ª©c t∆∞·ªùng",
"Wedge - C√°i n√™m","Weeping Willow - C√¢y d∆∞∆°ng li·ªÖu","Well - C√°i gi·∫øng","Whale - C√° voi","Wheel - B√°nh xe",
"Windchimes - Chu√¥ng gi√≥","Wishbone - X∆∞∆°ng ƒë√≤n","Woman - Ng∆∞·ªùi ph·ª• n·ªØ","Wreath - V√≤ng hoa","Yoke - S·ª± r√†ng bu·ªôc",
"Younger Man - Ng∆∞·ªùi ƒë√†n √¥ng tr·∫ª tu·ªïi","Younger Woman - Ng∆∞·ªùi ph·ª• n·ªØ tr·∫ª tu·ªïi",
"January - Th√°ng 1","February - Th√°ng 2","March - Th√°ng 3","April - Th√°ng 4","May - Th√°ng 5","June - Th√°ng 6",
"July - Th√°ng 7","August - Th√°ng 8","September - Th√°ng 9","October - Th√°ng 10","November - Th√°ng 11","December - Th√°ng 12",
"Career - S·ª± nghi·ªáp","Marriage - H√¥n nh√¢n","Happiness - H·∫°nh Ph√∫c","Love - T√¨nh y√™u","Success - Th√†nh c√¥ng","Wealth - T√†i ch√≠nh"
];

/* fallback random */
function secureRandom(max){
    try {
        if (window.crypto && window.crypto.getRandomValues) {
            const arr = new Uint32Array(1);
            window.crypto.getRandomValues(arr);
            return arr[0] % max;
        }
    } catch(e){
        // ignore and fallback to Math.random
        console.warn('crypto not available, fallback to Math.random', e);
    }
    return Math.floor(Math.random()*max);
}

/* r√∫t unique */
function drawUnique(count, deck){
    const drawn = [];
    const idxs = Array.from(deck.keys());
    for (let i=0;i<count;i++){
        if (idxs.length===0) break;
        const r = secureRandom(idxs.length);
        const ix = idxs.splice(r,1)[0];
        drawn.push(deck[ix]);
    }
    return drawn;
}

/* helpers hi·ªÉn th·ªã */
const resultEl = document.getElementById('result');

function showError(msg){
    resultEl.innerHTML = `<div class="error"><strong>L·ªói:</strong> ${msg}</div>`;
}

function showHtml(html){
    resultEl.innerHTML = html;
}

/* tr√¨nh b√†y k·∫øt qu·∫£ */
function displaySpread(title, cards){
    try {
        const positions = {
            3: ["L√° 1: Qu√° kh·ª© / G·ªëc r·ªÖ","L√° 2: Hi·ªán t·∫°i / T√¨nh h√¨nh","L√° 3: T∆∞∆°ng lai / Ti·ªÅm nƒÉng"],
            5: ["L√° 1: T√¨nh hu·ªëng c·ªët l√µi","L√° 2: Th√°ch th·ª©c","L√° 3: L·ªùi khuy√™n","L√° 4: ·∫¢nh h∆∞·ªüng t·ª´ b√™n ngo√†i","L√° 5: K·∫øt qu·∫£ cu·ªëi c√πng"]
        };
        let html = `<div class="spread-title">${title}</div><ul class="card-list">`;
        cards.forEach((c,i)=>{
            const label = positions[cards.length] ? positions[cards.length][i] : `L√° ${i+1}`;
            html += `<li><div class="card-title">${label}:</div><div>${c}</div></li>`;
        });
        html += `</ul><div class="actions"><button id="btn-redo">üîÅ R√∫t l·∫°i</button><button id="btn-show-deck">üìö Xem b·ªô b√†i</button></div>`;
        showHtml(html);
        document.getElementById('btn-redo').addEventListener('click', ()=>{ location.reload(); });
        document.getElementById('btn-show-deck').addEventListener('click', showFullDeck);
    } catch (err){
        showError(err.message || err);
        console.error(err);
    }
}

/* c√°c ch·∫ø ƒë·ªô tr·∫£i b√†i */
function spreadN(count,title){
    try {
        const cards = drawUnique(count, ALL_CARDS);
        displaySpread(title, cards);
    } catch(err){
        showError(err.message || err);
        console.error(err);
    }
}

function showFullDeck(){
    try {
        let html = `<div class="spread-title">To√†n b·ªô b·ªô b√†i (${ALL_CARDS.length} l√°)</div><div class="deck-grid">`;
        ALL_CARDS.forEach((c,i)=> html += `<div class="deck-item"><strong>${i+1}.</strong> ${c}</div>`);
        html += `</div><div class="actions"><button onclick="location.reload()">ƒê√≥ng</button></div>`;
        showHtml(html);
    } catch(err){
        showError(err.message || err);
        console.error(err);
    }
}

/* Countdown helper (10s) */
function startCountdown(count,title,fn){
    try {
        let t=10;
        const btns = document.querySelectorAll('.controls button');
        btns.forEach(b=>b.disabled=true);
        showHtml(`<div class="countdown-display"><p class="countdown-instruction">T·∫≠p trung v√† nghƒ© v·ªÅ v·∫•n ƒë·ªÅ c·ªßa b·∫°n...</p><div class="countdown-timer" id="cd-t">${t}</div><p class="countdown-instruction">Gi√¢y</p></div>`);
        const interval = setInterval(()=>{
            t--;
            const el=document.getElementById('cd-t');
            if (el) el.textContent = t;
            if (t<=0){
                clearInterval(interval);
                try {
                    fn();
                } finally {
                    btns.forEach(b=>b.disabled=false);
                }
            }
        },1000);
    } catch(err){
        showError(err.message || err);
        console.error(err);
    }
}

/* g·∫Øn event cho n√∫t */
document.getElementById('btn-3').addEventListener('click', ()=> startCountdown(3,'Tr·∫£i B√†i 3 L√°', ()=> spreadN(3,'Tr·∫£i B√†i 3 L√°')));
document.getElementById('btn-5').addEventListener('click', ()=> startCountdown(5,'Tr·∫£i B√†i 5 L√°', ()=> spreadN(5,'Tr·∫£i B√†i 5 L√°')));
document.getElementById('btn-7').addEventListener('click', ()=> startCountdown(7,'Tr·∫£i B√†i 7 Ng√†y', ()=> {
    const cards = drawUnique(7,ALL_CARDS);
    let html = `<div class="spread-title">Tr·∫£i B√†i Theo Tu·∫ßn (7 ng√†y)</div><ul class="card-list">`;
    const days=["Th·ª© Hai","Th·ª© Ba","Th·ª© T∆∞","Th·ª© NƒÉm","Th·ª© S√°u","Th·ª© B·∫£y","Ch·ªß Nh·∫≠t"];
    cards.forEach((c,i)=> html += `<li><div class="card-title">${days[i]}:</div><div>${c}</div></li>`);
    html += `</ul><div class="actions"><button onclick="location.reload()">ƒê√≥ng</button></div>`;
    showHtml(html);
}));
document.getElementById('btn-4').addEventListener('click', ()=> startCountdown(4,'Tr·∫£i B√†i Theo Th√°ng', ()=> {
    const cards = drawUnique(4,ALL_CARDS);
    let html = `<div class="spread-title">Tr·∫£i B√†i Theo Th√°ng (4 tu·∫ßn)</div><ul class="card-list">`;
    const weeks=["Tu·∫ßn 1","Tu·∫ßn 2","Tu·∫ßn 3","Tu·∫ßn 4"];
    cards.forEach((c,i)=> html += `<li><div class="card-title">${weeks[i]}:</div><div>${c}</div></li>`);
    html += `</ul><div class="actions"><button onclick="location.reload()">ƒê√≥ng</button></div>`;
    showHtml(html);
}));
document.getElementById('btn-12').addEventListener('click', ()=> startCountdown(12,'Tr·∫£i B√†i Theo NƒÉm', ()=> {
    const cards = drawUnique(12,ALL_CARDS);
    let html = `<div class="spread-title">Tr·∫£i B√†i Theo NƒÉm (12 th√°ng)</div><ul class="card-list">`;
    const months=["Th√°ng 1","Th√°ng 2","Th√°ng 3","Th√°ng 4","Th√°ng 5","Th√°ng 6","Th√°ng 7","Th√°ng 8","Th√°ng 9","Th√°ng 10","Th√°ng 11","Th√°ng 12"];
    cards.forEach((c,i)=> html += `<li><div class="card-title">${months[i]}:</div><div>${c}</div></li>`);
    html += `</ul><div class="actions"><button onclick="location.reload()">ƒê√≥ng</button></div>`;
    showHtml(html);
}));
document.getElementById('btn-deck').addEventListener('click', showFullDeck);

/* b·∫£o v·ªá: n·∫øu c√≥ l·ªói JS l√∫c load, hi·ªÉn th·ªã l·ªói */
window.addEventListener('error', function(evt){
    try {
        showError('C√≥ l·ªói tr√™n trang: ' + (evt && evt.message ? evt.message : 'unknown'));
        console.error(evt);
    } catch(e){}
});
</script>
</body>
</html>