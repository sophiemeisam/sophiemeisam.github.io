<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ứng Dụng Bài Trà Tiên Tri</title>
    <style>
        /* Thiết lập chung và font */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
            margin: 0;
            background-color: #f0f0f5; /* Nền xám nhạt */
            color: #1c1c1e; /* Chữ đen đậm */
            padding-bottom: 50px;
        }

        /* Container chính mô phỏng màn hình app */
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #ffffff;
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }

        /* Header Bar (Thanh điều hướng) - Đã sửa lỗi chồng lấn */
        .header-bar {
            display: grid;
            /* Chia 3 cột: 1 (Back Link) | auto (Title) | 1 (Căn chỉnh) */
            grid-template-columns: 1fr auto 1fr; 
            align-items: center;
            padding: 15px 20px 10px;
            border-bottom: 1px solid #e5e5ea;
            position: sticky;
            top: 0;
            background-color: #fff;
            z-index: 10;
        }

        /* Nút Về Trang Trước (iOS style) - Đã tăng size và độ đậm */
        .back-link {
            text-decoration: none;
            color: #007aff; 
            font-size: 18px; /* Tăng kích thước */
            font-weight: 600; /* Tăng độ đậm */
            display: flex;
            align-items: center;
            justify-self: start; /* Đặt ở cột 1, căn trái */
        }
        .back-link:before {
            content: '‹';
            font-size: 32px; /* Kích thước mũi tên */
            margin-right: 4px; /* Tăng khoảng cách */
            line-height: 1;
            font-weight: 500;
        }

        h1 {
            color: #1c1c1e;
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            text-align: center;
            justify-self: center; /* Đặt ở cột 2, căn giữa */
        }
        
        .content {
            padding: 20px;
        }

        /* Controls và Buttons */
        .controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        button {
            padding: 15px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 17px;
            font-weight: 500;
            background-color: #007aff;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 122, 255, 0.4);
            transition: background-color 0.2s, transform 0.1s;
        }
        button:active {
            transform: scale(0.98);
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Khu vực kết quả */
        #result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f7f7f9;
            border-radius: 12px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.08);
            min-height: 120px;
        }
        .spread-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #38761d;
            text-align: center;
        }
        
        /* Giao diện đếm ngược */
        .countdown-display {
            text-align: center;
            padding: 30px 0;
            color: #007aff;
        }
        .countdown-timer {
            font-size: 4em;
            font-weight: 700;
            margin: 10px 0;
        }
        .countdown-instruction {
            font-size: 1.1em;
            color: #8e8e93;
            font-weight: 500;
        }

        /* Danh sách lá bài */
        .card-list {
            list-style: none;
            padding: 0;
        }
        .card-list li {
            background-color: #ffffff;
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-left: 3px solid #38761d;
        }
        .card-title {
            font-weight: 600;
            color: #007aff;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-bar">
            <a href="#" class="back-link">Về trang trước</a>
            
            <h1>Bài Trà Tiên Tri</h1>
            
            <div></div> 
        </div>
        
        <div class="content">
            <div class="controls">
                <button id="btn-3" onclick="startCountdown(3, 'Tình Hình Chung', 'performSpread')">Trải Bài: Tình Hình Chung (3 Lá)</button>

                <button id="btn-5" onclick="startCountdown(5, 'Phân Tích Sâu Sắc', 'performSpread')">Trải Bài: Phân Tích Sâu Sắc (5 Lá)</button>

                <button id="btn-7" onclick="startCountdown(7, 'Trải Bài Theo Tuần', 'performWeeklySpread')">Trải Bài Theo Tuần (7 Lá)</button>

                <button id="btn-4" onclick="startCountdown(4, 'Trải Bài Theo Tháng', 'performMonthlySpread')">Trải Bài Theo Tháng (4 Lá)</button>

                <button id="btn-12" onclick="startCountdown(12, 'Trải Bài Theo Năm', 'performYearlySpread')">Trải Bài Theo Năm (12 Lá)</button>
            </div>

            <div id="result">
                <p style="text-align: center; color: #8e8e93;">Chọn một kiểu trải bài và tập trung trong 10 giây để nhận thông điệp.</p>
            </div>
        </div>
    </div>

    <script>
        // Danh sách 200 lá bài (Dựa trên danh sách bạn cung cấp)
        const ALL_CARDS = [
            "Angel - Tiên nữ", "Ant - Con kiến", "Apple - Quả táo", "Archway - Cổng vòm", "Arrow - Mũi tên", 
            "Axe - Cây rìu", "Bag - Túi", "Barrel - Thùng Rỗng", "Basket - Giỏ rơm", "Bat - Con dơi",
            "Bear - Con gấu", "Beetle - Bọ cánh cứng", "Bell - Cái chuông", "Bird Flying - Chim bay", "Bird Perched - Chim đậu", 
            "Boat - Con thuyền", "Boot - Chiếc ủng", "Bouquet - Bó hoa", "Bow - Cái nơ", "Bowl - Cái chậu",
            "Box - Cái hộp", "Bread - Bánh mì", "Bridge - Cây cầu", "Broken Bridge - Cầu gãy", "Broken Ring - Chia ly, chấm dứt", 
            "Broken Wishbone - Xương đòn bị gãy", "Broom - Cây chổi", "Bull - Bò đực", "Butterfly - Con bướm", "Camel - Con lạc đà", 
            "Candle - Ngọn nến", "Cane - Gậy chống, batoong", "Carriage - Cỗ xe thùng", "Carrot - Củ cà rốt", "Casket - Quan tài", 
            "Cat - Con mèo", "Caterpillar - Con sâu", "Chain - Sợi dây xích", "Chair Empty - Chiếc ghế trống", "Chair Filled - Người ngồi ghế",
            "Claw - Móng vuốt", "Clouds - Đám mây", "Club - Cây chùy", "Cobweb - Mạng nhện", "Coins - Tiền xu", 
            "Cracked Cup - Cốc vỡ", "Crib - Cái nôi", "Crown - Vương miện", "Cup - Cái tách", "Dagger - Dao găm",
            "Dark Man - Người đàn ông màu đen", "Dark Woman - Người phụ nữ màu đen", "Desk - Cái bàn", "Diamond - Kim cương", "Dog - 1 chú chó", 
            "Dogs - 2 chú chó", "Dog Barking - Chó sủa", "Dog Close Up - Chó vui vẻ", "Dog Far Away - Chú chó buồn bã", "Dolphin - Cá heo",
            "Door - Cánh cửa", "Dragon - Con rồng", "Eagle - Con chim ưng", "Ear - Cái tai", "Egg - Quả trứng", 
            "Elephant - Con voi", "Eye - Con mắt", "Fair Man - Người đàn ông sáng màu", "Fair Woman - Người phụ nữ sáng màu", "Fan - Quạt",
            "Feather - Lông vũ", "Finger - Ngón tay", "Fire - Ngọn lửa", "Firecracker - Pháo hoa nổ", "Flag - Lá cờ", 
            "Flowers - Hoa nở", "Flute - Ông sáo", "Fly - Con ruồi", "Forest - Khu rừng", "Four Leaf Clover - Cỏ 4 lá",
            "Fox - Con cáo", "Frying Pan - Cái chảo", "Funnel - Cái phễu", "Gavel - Cái búa", "Gong - Cái chiêng",
            "Goldfish - Cá vàng", "Grapes - Chùm nho", "Grasshopper - Con cào cào", "Hammock - Cái võng", "Hand - Bàn tay",
            "Handshake - Bắt tay", "Harp - Đàn hạc", "Hat - Cái mũ", "Haystack - Rơm cỏ khô", "Heart - Trái tim",
            "Hills - Ngọn đồi", "Horse - Con ngựa", "Horseshoe - Móng ngựa", "Inkpot - Bình mực", "Jug - Cái bình",
            "Kangaroo - Chuột túi", "Key - Chìa khóa", "Kite - Con diều", "Knot - Nút thắt", "Ladder - Bậc thang",
            "Leg - Chân", "Lightning - Tia chớp", "Lily - Hoa lily", "Lion - Sư tử", "Lobster - Con tôm",
            "Man - Người đàn ông", "Mice - Con chuột", "Money Path - Con đường tiền", "Moon - Mặt trăng", "Mountain - Ngọn núi",
            "Mountain Road - Đường lên núi", "Mule - Con lừa", "Needle & Thread - Kim chỉ", "Nest - Tổ chim", "Older Man - Người đàn ông lớn tuổi",
            "Older Woman - Người phụ nữ lớn tuổi", "Owl - Con cú", "Pail - Thùng nước", "Parrot - Con vẹt", "Peacock - Con công",
            "Pig - Con lợn", "Pin - Đinh ghim", "Pineapple - Quả dứa", "Purse - Túi tiền", "Quill - Bút lông ngỗng",
            "Rabbit - Con thỏ", "Rainbow - Cầu vồng", "Ram - Cừu đực", "Rat - Chuột đồng", "Ring - Chiếc nhẫn",
            "Rooster - Gà trống", "Rose - Hoa hồng", "Scales - Cán cân", "Scissors - Cắt đứt mối quan hệ, đưa ra quyết định chia tách", "Sea Horse - Cá ngựa",
            "Shark - Cá mập", "Shield - Cái khiên", "Skull - Đầu lâu", "Spear - Ngọn giáo", "Staff - Hỗ trợ, sự giúp đỡ, chỉ dẫn",
            "Star - Ngôi sao", "Stork - Con cò", "Sun - Mặt trời", "Sunrise - Bình minh", "Table - Cái bàn",
            "Tankard - Cốc vại", "Target - Bia bắn", "Teapot - Bình trà", "Teardrops - Giọt nước mắt", "Tent - Cái lều",
            "Throne - Ngai vàng", "Tiger - Con hổ", "Torch - Ngọn đuốc", "Tortoise - Con rùa", "Tower - Toà tháp",
            "Tree - Cây", "Tulip - Hoa tulip", "Turkey - Gà tây", "Unicorn - Kỳ lân", "V - Chữ V",
            "Valley - Thung lũng", "Vase - Lọ hoa", "Vine - Cành nho xanh", "Vulture - Con kềnh kềnh", "Wall - Bức tường",
            "Wedge - Cái nêm", "Weeping Willow - Cây dương liễu", "Well - Cái giếng", "Whale - Cá voi", "Wheel - Bánh xe",
            "Windchimes - Chuông gió", "Wishbone - Xương đòn", "Woman - Người phụ nữ", "Wreath - Vòng hoa", "Yoke - Sự ràng buộc, áp lực, trách nhiệm nặng nề",
            "Younger Man - Người đàn ông trẻ tuổi", "Younger Woman - Người phụ nữ trẻ tuổi",

            "January - Tháng 1", "February - Tháng 2", "March - Tháng 3", "April - Tháng 4", "May - Tháng 5", "June - Tháng 6", 
            "July - Tháng 7", "August - Tháng 8", "September - Tháng 9", "October - Tháng 10", "November - Tháng 11", "December - Tháng 12", 

            "Career - Sự nghiệp", "Marriage - Hôn nhân", "Happiness - Hạnh Phúc", "Love - Tình yêu", "Success - Thành công", "Wealth - Tài chính"
        ];
        
        // --- CÁC HÀM XỬ LÝ CHÍNH ---

        /**
         * Thuật toán ngẫu nhiên được seeded bằng thời gian thực để mô phỏng entropy.
         */
        function seededRandom(max) {
            const seed = Date.now();
            let randomValue = Math.sin(seed * 1000) * 10000;
            randomValue = randomValue - Math.floor(randomValue); 
            
            return Math.floor(randomValue * max);
        }

        /**
         * Rút ngẫu nhiên một số lá bài duy nhất
         */
        function drawUniqueCards(count, deck) {
            const drawn = [];
            const availableIndices = [...Array(deck.length).keys()];

            for (let i = 0; i < count; i++) {
                if (availableIndices.length === 0) break;

                const randomIndex = seededRandom(availableIndices.length);
                const cardIndex = availableIndices[randomIndex];
                
                drawn.push(deck[cardIndex]);

                availableIndices.splice(randomIndex, 1);
            }
            return drawn;
        }
        
        /**
         * Hàm điều khiển quá trình đếm ngược và trải bài
         */
        function startCountdown(count, title, spreadFunction) {
            let timer = 10;
            const resultDiv = document.getElementById('result');
            const buttons = document.querySelectorAll('.controls button');

            // 1. Vô hiệu hóa tất cả các nút
            buttons.forEach(btn => btn.disabled = true);
            
            // 2. Hiển thị giao diện đếm ngược
            resultDiv.innerHTML = `
                <div class="countdown-display">
                    <p class="countdown-instruction">Tập trung và suy nghĩ về vấn đề của bạn...</p>
                    <div class="countdown-timer" id="timer-display">${timer}</div>
                    <p class="countdown-instruction">Giây</p>
                </div>
            `;
            
            // 3. Bắt đầu đếm ngược
            const interval = setInterval(() => {
                timer--;
                document.getElementById('timer-display').textContent = timer;

                if (timer <= 0) {
                    clearInterval(interval);
                    
                    // 4. Gọi hàm trải bài tương ứng khi kết thúc
                    if (spreadFunction === 'performSpread') {
                        performSpread(count, title);
                    } else if (spreadFunction === 'performWeeklySpread') {
                        performWeeklySpread();
                    } else if (spreadFunction === 'performMonthlySpread') {
                        performMonthlySpread();
                    } else if (spreadFunction === 'performYearlySpread') {
                        performYearlySpread();
                    }
                    
                    // 5. Kích hoạt lại các nút
                    buttons.forEach(btn => btn.disabled = false);
                }
            }, 1000); // 1 giây = 1000ms
        }
        
        // --- CÁC HÀM TRẢI BÀI CỤ THỂ ---

        function performSpread(count, title) {
            const drawnCards = drawUniqueCards(count, ALL_CARDS);
            displayResults(title, drawnCards);
        }

        function performWeeklySpread() {
            const days = ["Thứ Hai", "Thứ Ba", "Thứ Tư", "Thứ Năm", "Thứ Sáu", "Thứ Bảy", "Chủ Nhật"];
            const drawnCards = drawUniqueCards(7, ALL_CARDS);
            
            let html = '<div class="spread-title">Trải Bài Theo Tuần (7 Ngày)</div>';
            html += '<ul class="card-list">';
            drawnCards.forEach((card, index) => {
                html += `<li><span class="card-title">${days[index]}:</span> ${card}</li>`;
            });
            html += '</ul>';
            document.getElementById('result').innerHTML = html;
        }

        function performMonthlySpread() {
            const weeks = ["Tuần 1 (Đầu tháng)", "Tuần 2", "Tuần 3", "Tuần 4 (Cuối tháng)"];
            const drawnCards = drawUniqueCards(4, ALL_CARDS); 
            
            let html = '<div class="spread-title">Trải Bài Theo Tháng (4 Tuần)</div>';
            html += '<ul class="card-list">';
            drawnCards.forEach((card, index) => {
                html += `<li><span class="card-title">${weeks[index]}:</span> ${card}</li>`;
            });
            html += '</ul>';
            document.getElementById('result').innerHTML = html;
        }

        function performYearlySpread() {
            const months = [
                "Tháng 1 (Khởi đầu)", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6",
                "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12 (Kết thúc)"
            ];
            const drawnCards = drawUniqueCards(12, ALL_CARDS); 

            let html = '<div class="spread-title">Trải Bài Theo Năm (12 Tháng)</div>';
            html += '<ul class="card-list">';
            drawnCards.forEach((card, index) => {
                html += `<li><span class="card-title">${months[index]}:</span> ${card}</li>`;
            });
            html += '</ul>';
            document.getElementById('result').innerHTML = html;
        }

        /**
         * Hiển thị kết quả chung cho các trải bài đơn giản
         */
        function displayResults(title, cards) {
            let html = `<div class="spread-title">${title} - Kết Quả</div>`;
            html += '<ul class="card-list">';
            
            const positions = {
                3: ["Lá 1: Quá khứ / Gốc rễ", "Lá 2: Hiện tại / Tình hình", "Lá 3: Tương lai / Tiềm năng"],
                5: ["Lá 1: Tình huống cốt lõi", "Lá 2: Thách thức", "Lá 3: Lời khuyên", "Lá 4: Ảnh hưởng từ bên ngoài", "Lá 5: Kết quả cuối cùng"]
            };

            cards.forEach((card, index) => {
                const position = positions[cards.length] ? positions[cards.length][index] : `Lá ${index + 1}`;
                html += `<li><span class="card-title">${position}:</span> ${card}</li>`;
            });
            html += '</ul>';
            document.getElementById('result').innerHTML = html;
        }
    </script>
</body>
</html>
