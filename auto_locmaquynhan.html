<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Tra Cứu Thần Sát Toàn Diện</title>
    <style>
        :root {
            --bg-body: #f4f4f9;
            --bg-card: #ffffff;
            --primary: #b22222;
            --gold: #d4af37;
            --text: #333;
            --success: #27ae60;
        }
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg-body);
            color: var(--text);
            padding: 20px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .section-container {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            max-width: 550px;
            width: 100%;
            margin-bottom: 30px;
        }
        h1, h2 {
            color: var(--primary);
            text-align: center;
            text-transform: uppercase;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 10px;
            margin-top: 0;
        }
        h2 { font-size: 1.2rem; }

        /* Style cho Code A */
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; background: #fff; font-size: 14px; }
        button { width: 100%; padding: 12px; background: var(--success); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; }
        button:hover { background: #219150; }
        #resultA { margin-top: 20px; padding: 15px; border-radius: 8px; background: #e8f6ef; display: none; border: 1px dashed var(--success); }
        .res-item { margin-bottom: 8px; border-bottom: 1px solid #d1e7dd; padding-bottom: 5px; font-size: 14px; }
        strong { color: var(--primary); }

        /* Style cho Code B */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .cell { aspect-ratio: 1/1; border: 1.5px solid var(--gold); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: 4px; background: #fff; position: relative; }
        .cell-num { font-weight: bold; color: #ccc; font-size: 12px; position: absolute; top: 2px; left: 4px; }
        .cell-name { font-size: 10px; color: #888; margin-top: 14px; font-weight: bold; }
        .cell-content { display: flex; flex-direction: column; gap: 2px; width: 100%; align-items: center; margin-top: 4px; }
        .tag { font-size: 10px; font-weight: bold; padding: 2px; border-radius: 3px; width: 95%; text-align: center; line-height: 1.2; }
        .tag-goc { background: #fffde7; border: 1px solid #fbc02d; color: #000; }
        .tag-loc { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
        .tag-ma { background: #e3f2fd; color: #1565c0; border: 1px solid #bbdefb; }
        .tag-duong { background: #fff3e0; color: #ef6c00; border: 1px solid #ffe0b2; }
        .tag-am { background: #f3e5f5; color: #7b1fa2; border: 1px solid #e1bee7; }
        #cell4 { grid-area: 1/1; } #cell9 { grid-area: 1/2; } #cell2 { grid-area: 1/3; }
        #cell3 { grid-area: 2/1; } #cell5 { grid-area: 2/2; } #cell7 { grid-area: 2/3; }
        #cell8 { grid-area: 3/1; } #cell1 { grid-area: 3/2; } #cell6 { grid-area: 3/3; }
        .form-area-B { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .full-width { grid-column: span 2; }
        .result-panel-B { margin-top: 15px; padding: 10px; background: #fdfdfd; border-radius: 8px; border: 1px dashed var(--gold); font-size: 12px; line-height: 1.5; }
    </style>
</head>
<body>

<div class="section-container">
    <h2>1. Xác Định Lộc - Mã - Quý Nhân</h2>
    <div class="form-group">
        <label>Chọn Thiên Can (Năm/Ngày):</label>
        <select id="canA">
            <option value="Giáp">Giáp</option><option value="Ất">Ất</option>
            <option value="Bính">Bính</option><option value="Đinh">Đinh</option>
            <option value="Mậu">Mậu</option><option value="Kỷ">Kỷ</option>
            <option value="Canh">Canh</option><option value="Tân">Tân</option>
            <option value="Nhâm">Nhâm</option><option value="Quý">Quý</option>
        </select>
    </div>
    <div class="form-group">
        <label>Chọn Địa Chi (Năm/Ngày):</label>
        <select id="chiA">
            <option value="Tý">Tý</option><option value="Sửu">Sửu</option>
            <option value="Dần">Dần</option><option value="Mão">Mão</option>
            <option value="Thìn">Thìn</option><option value="Tỵ">Tỵ</option>
            <option value="Ngọ">Ngọ</option><option value="Mùi">Mùi</option>
            <option value="Thân">Thân</option><option value="Dậu">Dậu</option>
            <option value="Tuất">Tuất</option><option value="Hợi">Hợi</option>
        </select>
    </div>
    <button onclick="calculateA()">TÍNH TOÁN CƠ BẢN</button>
    <div id="resultA"></div>
</div>

<div class="section-container">
    <h2>2. Phi Tinh Lộc Mã Quý Nhân</h2>
    <div class="grid">
        <div class="cell" id="cell4"><span class="cell-num">4</span><span class="cell-name">Tốn-ĐN</span><div class="cell-content" id="cont4"></div></div>
        <div class="cell" id="cell9"><span class="cell-num">9</span><span class="cell-name">Ly-Nam</span><div class="cell-content" id="cont9"></div></div>
        <div class="cell" id="cell2"><span class="cell-num">2</span><span class="cell-name">Khôn-TN</span><div class="cell-content" id="cont2"></div></div>
        <div class="cell" id="cell3"><span class="cell-num">3</span><span class="cell-name">Chấn-Đ</span><div class="cell-content" id="cont3"></div></div>
        <div class="cell" id="cell5"><span class="cell-num">5</span><span class="cell-name">Trung Cung</span><div class="cell-content" id="cont5"></div></div>
        <div class="cell" id="cell7"><span class="cell-num">7</span><span class="cell-name">Đoài-T</span><div class="cell-content" id="cont7"></div></div>
        <div class="cell" id="cell8"><span class="cell-num">8</span><span class="cell-name">Cấn-ĐB</span><div class="cell-content" id="cont8"></div></div>
        <div class="cell" id="cell1"><span class="cell-num">1</span><span class="cell-name">Khảm-B</span><div class="cell-content" id="cont1"></div></div>
        <div class="cell" id="cell6"><span class="cell-num">6</span><span class="cell-name">Càn-TB</span><div class="cell-content" id="cont6"></div></div>
    </div>

    <div class="form-area-B">
        <div class="form-group full-width">
            <label style="color:var(--primary)">Can Chi Nhập Trung Cung (Năm/Tháng xem):</label>
            <select id="selB_A" onchange="runB()"></select>
        </div>
        <div class="form-group"><label>Chính Lộc:</label><select id="selB_B" onchange="runB()"></select></div>
        <div class="form-group"><label>Chính Mã:</label><select id="selB_C" onchange="runB()"></select></div>
        <div class="form-group"><label>Dương Quý:</label><select id="selB_D" onchange="runB()"></select></div>
        <div class="form-group"><label>Âm Quý:</label><select id="selB_E" onchange="runB()"></select></div>
    </div>
    <div class="result-panel-B" id="msgB"></div>
</div>

<script>
    // --- DỮ LIỆU CHUNG ---
    const hoaGiap = ["Giáp Tý","Ất Sửu","Bính Dần","Đinh Mão","Mậu Thìn","Kỷ Tị","Canh Ngọ","Tân Mùi","Nhâm Thân","Quý Dậu","Giáp Tuất","Ất Hợi","Bính Tý","Đinh Sửu","Mậu Dần","Kỷ Mão","Canh Thìn","Tân Tị","Nhâm Ngọ","Quý Mùi","Giáp Thân","Ất Dậu","Bính Tuất","Đinh Hợi","Mậu Tý","Kỷ Sửu","Canh Dần","Tân Mão","Nhâm Thìn","Quý Tị","Giáp Ngọ","Ất Mùi","Bính Thân","Đinh Dậu","Mậu Tuất","Kỷ Hợi","Canh Tý","Tân Sửu","Nhâm Dần","Quý Mão","Giáp Thìn","Ất Tị","Bính Ngọ","Đinh Mùi","Mậu Thân","Kỷ Dậu","Canh Tuất","Tân Hợi","Nhâm Tý","Quý Sửu","Giáp Dần","Ất Mão","Bính Thìn","Đinh Tị","Mậu Ngọ","Kỷ Mùi","Canh Thân","Tân Dậu","Nhâm Tuất","Quý Hợi"];
    
    const dataLoc = {"Giáp":"Dần","Ất":"Mão","Bính":"Tỵ","Đinh":"Ngọ","Mậu":"Tỵ","Kỷ":"Ngọ","Canh":"Thân","Tân":"Dậu","Nhâm":"Hợi","Quý":"Tý"};
    const dataMa = {"Tý":"Dần","Sửu":"Hợi","Dần":"Thân","Mão":"Tỵ","Thìn":"Dần","Tỵ":"Hợi","Ngọ":"Thân","Mùi":"Tỵ","Thân":"Dần","Dậu":"Hợi","Tuất":"Thân","Hợi":"Tỵ"};
    const dataQN = {
        "Giáp":{am:"Sửu",duong:"Mùi"},"Ất":{am:"Tý",duong:"Thân"},"Bính":{am:"Hợi",duong:"Dậu"},"Đinh":{am:"Dậu",duong:"Hợi"},"Mậu":{am:"Mùi",duong:"Sửu"},
        "Kỷ":{am:"Thân",duong:"Tý"},"Canh":{am:"Mùi",duong:"Sửu"},"Tân":{am:"Ngọ",duong:"Dần"},"Nhâm":{am:"Tỵ",duong:"Mão"},"Quý":{am:"Mão",duong:"Tỵ"}
    };

    // --- LOGIC CODE A ---
    function getNguHoDon(canNam, chiMucTieu) {
        const cans = ["Giáp","Ất","Bính","Đinh","Mậu","Kỷ","Canh","Tân","Nhâm","Quý"];
        const chis = ["Dần","Mão","Thìn","Tỵ","Ngọ","Mùi","Thân","Dậu","Tuất","Hợi","Tý","Sửu"];
        let startIdx;
        if(["Giáp","Kỷ"].includes(canNam)) startIdx=2;
        else if(["Ất","Canh"].includes(canNam)) startIdx=4;
        else if(["Bính","Tân"].includes(canNam)) startIdx=6;
        else if(["Đinh","Nhâm"].includes(canNam)) startIdx=8;
        else startIdx=0;
        let targetIdx = chis.indexOf(chiMucTieu);
        return cans[(startIdx + targetIdx) % 10];
    }

    function calculateA() {
        const can = document.getElementById("canA").value;
        const chi = document.getElementById("chiA").value;
        const res = document.getElementById("resultA");
        const locChi = dataLoc[can], maChi = dataMa[chi], qn = dataQN[can];
        
        const loc = `${getNguHoDon(can, locChi)} ${locChi}`;
        const ma = `${getNguHoDon(can, maChi)} ${maChi}`;
        const dQn = `${getNguHoDon(can, qn.duong)} ${qn.duong}`;
        const aQn = `${getNguHoDon(can, qn.am)} ${qn.am}`;

        res.style.display = "block";
        res.innerHTML = `
            <div class="res-item">Chính Lộc: <strong>${loc}</strong></div>
            <div class="res-item">Chính Mã: <strong>${ma}</strong></div>
            <div class="res-item">Dương Quý (Ngày): <strong>${dQn}</strong></div>
            <div class="res-item">Âm Quý (Đêm): <strong>${aQn}</strong></div>
            <p style="font-size:11px; color:#666; margin:5px 0 0 0;">* Đã tự động tính Ngũ Hổ Độn cho Thiên Can đi kèm.</p>
        `;
    }

    // --- LOGIC CODE B ---
    const luongThienXich = [5, 6, 7, 8, 9, 1, 2, 3, 4];
    const cungNames = {1:"Khảm", 2:"Khôn", 3:"Chấn", 4:"Tốn", 5:"Trung Cung", 6:"Càn", 7:"Đoài", 8:"Cấn", 9:"Ly"};

    function initB() {
        ['selB_A', 'selB_B', 'selB_C', 'selB_D', 'selB_E'].forEach(id => {
            const el = document.getElementById(id);
            hoaGiap.forEach(item => {
                let opt = document.createElement('option');
                opt.value = item; opt.text = item;
                el.appendChild(opt);
            });
        });
        document.getElementById('selB_A').value = "Giáp Thìn";
        document.getElementById('selB_B').value = "Giáp Dần";
        document.getElementById('selB_C').value = "Nhâm Thân";
        document.getElementById('selB_D').value = "Kỷ Mùi";
        document.getElementById('selB_E').value = "Tân Sửu";
        runB();
    }

    function runB() {
        for(let i=1; i<=9; i++) document.getElementById('cont' + i).innerHTML = "";
        const gA = document.getElementById('selB_A').value;
        const targets = [
            { v: document.getElementById('selB_B').value, c: 'tag-loc', n: 'Lộc' },
            { v: document.getElementById('selB_C').value, c: 'tag-ma', n: 'Mã' },
            { v: document.getElementById('selB_D').value, c: 'tag-duong', n: 'D.Quý' },
            { v: document.getElementById('selB_E').value, c: 'tag-am', n: 'Â.Quý' }
        ];
        document.getElementById('cont5').innerHTML = `<div class="tag tag-goc">${gA}</div>`;
        let log = `<b>Năm nhập Trung Cung: ${gA}</b><br>`;
        targets.forEach(t => {
            const dist = (hoaGiap.indexOf(t.v) - hoaGiap.indexOf(gA) + 60) % 60;
            const cungNum = luongThienXich[dist % 9];
            document.getElementById('cont' + cungNum).innerHTML += `<div class="tag ${t.c}">${t.n}: ${t.v}</div>`;
            log += `• ${t.n} (${t.v}) đáo <b>${cungNames[cungNum]} (${cungNum})</b><br>`;
        });
        document.getElementById('msgB').innerHTML = log;
    }

    window.onload = function() {
        initB();
    };
</script>
</body>
</html>
