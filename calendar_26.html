<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Âm Dương 2026 - Tiết Khí & Thiên Xá Chuẩn</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* GIỮ NGUYÊN CSS CỦA BẠN */
        :root { --color-primary-teal: #00BCD4; --color-secondary-coral: #FF7043; --color-accent-lime: #CDDC39; --color-bg-light: #F4F8F9; --color-text-dark: #263238; --color-text-light: #FFFFFF; }
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #e0f7fa 0%, #fce4ec 100%); margin: 0; padding: 20px; color: var(--color-text-dark); min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding-top: 80px; }
        header { background: linear-gradient(90deg, var(--color-primary-teal), #00ACC1); padding: 15px 0; position: fixed; width: 100%; top: 0; z-index: 1000; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: center; }
        .main-menu ul { list-style: none; display: flex; }
        .main-menu ul li a { padding: 12px 24px; background: var(--color-secondary-coral); color: #fff; text-decoration: none; font-weight: 700; border-radius: 25px; border: 1px solid #fff; }
        h2, h3 { color: var(--color-primary-teal); text-transform: uppercase; font-weight: 800; text-align: center; margin: 15px 0; }
        .controls { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 15px; background: #fff; padding: 20px; border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); width: 100%; max-width: 700px; }
        select, input { padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-weight: 600; }
        button { padding: 12px 24px; background: var(--color-primary-teal); color: #fff; border: none; border-radius: 25px; font-weight: 800; cursor: pointer; }
        table { width: 100%; max-width: 700px; border-collapse: collapse; background: #fff; border-radius: 16px; overflow: hidden; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #E0F7FA; padding: 12px 8px; text-align: center; cursor: pointer; }
        th { background: var(--color-secondary-coral); color: #fff; }
        .today { background-color: var(--color-accent-lime) !important; border: 2px solid #AFB42B; }
        td strong { font-size: 24px; display: block; }
        .calendar-container { background: #fff; padding: 20px; border-radius: 16px; margin: 10px 0; width: 100%; max-width: 700px; border-left: 5px solid var(--color-secondary-coral); }
        #notes { border-left: 5px solid var(--color-primary-teal); }
        #thienXaDaysList li { background: #FFEBEE; color: #E53935; padding: 10px; border-radius: 8px; margin-bottom: 5px; list-style: none; font-weight: 700; }
        .modal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background: #fff; padding: 30px; border-radius: 16px; width: 90%; max-width: 500px; }
    </style>
</head>
<body>
    <header><div class="container"><nav class="main-menu"><ul><li><a href="#">Trang Chủ</a></li></ul></nav></div></header>

    <h2>Lịch 2026 - Tiết Khí & Thiên Xá</h2>
    <div class="controls">
        <label>Tháng:</label>
        <select id="month">
            <script>for(let i=1;i<=12;i++) document.write(`<option value="${i}">Tháng ${i}</option>`)</script>
        </select>
        <label>Năm:</label>
        <input type="number" id="year" value="2026">
        <button onclick="generateCalendar()">Xem lịch</button>
    </div>

    <div id="calendar" class="calendar-container"></div>
    <div id="thienXaDays" class="calendar-container">
        <h3>Ngày Thiên Xá Trong Tháng</h3>
        <div id="thienXaDaysList"></div>
    </div>

    <div id="dayModal" class="modal"><div class="modal-content"><span style="float:right;cursor:pointer" onclick="closeModal()">×</span><h3 id="modal-title"></h3><div id="modal-details"></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/@nghiavuive/lunar_date_vi@latest/dist/index.umd.js"></script>
    <script>
        const LunarDateLib = window._calendar;

        // DATA THỦ CÔNG 2026 BẠN SOẠN
        const DATA_2026 = [
            { n: "Tiểu Hàn", d: 5, m: 1, t: "15:24", mc: "Kỷ Sửu", nc: "Ất Tỵ", season: "Đông" },
            { n: "Lập Xuân", d: 4, m: 2, t: "03:03", mc: "Canh Dần", nc: "Bính Ngọ", season: "Xuân" },
            { n: "Kinh Trập", d: 5, m: 3, t: "21:00", mc: "Tân Mão", nc: "Bính Ngọ", season: "Xuân" },
            { n: "Thanh Minh", d: 5, m: 4, t: "01:41", mc: "Nhâm Thìn", nc: "Bính Ngọ", season: "Xuân" },
            { n: "Lập Hạ", d: 5, m: 5, t: "18:49", mc: "Quý Tị", nc: "Bính Ngọ", season: "Hạ" },
            { n: "Mang Chủng", d: 5, m: 6, t: "22:49", mc: "Giáp Ngọ", nc: "Bính Ngọ", season: "Hạ" },
            { n: "Tiểu Thử", d: 7, m: 7, t: "08:58", mc: "Ất Mùi", nc: "Bính Ngọ", season: "Hạ" },
            { n: "Lập Thu", d: 7, m: 8, t: "18:43", mc: "Bính Thân", nc: "Bính Ngọ", season: "Thu" },
            { n: "Bạch Lộ", d: 7, m: 9, t: "21:42", mc: "Đinh Dậu", nc: "Bính Ngọ", season: "Thu" },
            { n: "Hàn Lộ", d: 8, m: 10, t: "13:30", mc: "Mậu Tuất", nc: "Bính Ngọ", season: "Thu" },
            { n: "Lập Đông", d: 7, m: 11, t: "16:53", mc: "Kỷ Hợi", nc: "Bính Ngọ", season: "Đông" },
            { n: "Đại Tuyết", d: 7, m: 12, t: "09:53", mc: "Canh Tý", nc: "Bính Ngọ", season: "Đông" },
            { n: "Tiểu Hàn", d: 5, m: 1, y: 2027, t: "21:11", mc: "Tân Sửu", nc: "Bính Ngọ", season: "Đông" },
            { n: "Lập Xuân", d: 4, m: 2, y: 2027, t: "08:47", mc: "Nhâm Dần", nc: "Đinh Mùi", season: "Xuân" }
        ];

        function getManualInfo(d, m, y) {
            let res = { mc: "Mậu Tý", nc: "Ất Tỵ", term: "", season: "Đông" };
            let current = new Date(y, m - 1, d, 12, 0);
            for (let it of DATA_2026) {
                let itY = it.y || 2026;
                let itDate = new Date(itY, it.m - 1, it.d, parseInt(it.t.split(':')[0]), parseInt(it.t.split(':')[1]));
                if (current >= itDate) {
                    res.mc = it.mc; res.nc = it.nc; res.season = it.season;
                }
                if (it.d === d && it.m === m && itY === y) res.term = it.n + " (" + it.t + ")";
            }
            return res;
        }

        function generateCalendar() {
            const m = parseInt(document.getElementById('month').value);
            const y = parseInt(document.getElementById('year').value);
            const daysInMonth = new Date(y, m, 0).getDate();
            const firstDay = new Date(y, m - 1, 1).getDay();
            
            let thienXaList = [];
            let table = '<table><thead><tr><th>CN</th><th>T2</th><th>T3</th><th>T4</th><th>T5</th><th>T6</th><th>T7</th></tr></thead><tbody><tr>';
            
            for (let i = 0; i < firstDay; i++) table += '<td></td>';

            for (let d = 1; d <= daysInMonth; d++) {
                if ((firstDay + d - 1) % 7 === 0 && d > 1) table += '</tr><tr>';
                
                const solar = new LunarDateLib.SolarDate({ day: d, month: m, year: y });
                const lunar = solar.toLunarDate(); lunar.init();
                const info = getManualInfo(d, m, y);
                const canChiDay = lunar.getDayName();
                
                // Logic Thiên Xá: Xuân Mậu Dần, Hạ Giáp Ngọ, Thu Mậu Thân, Đông Giáp Tý
                let isTX = false;
                if (info.season === "Xuân" && canChiDay === "Mậu Dần") isTX = true;
                if (info.season === "Hạ" && canChiDay === "Giáp Ngọ") isTX = true;
                if (info.season === "Thu" && canChiDay === "Mậu Thân") isTX = true;
                if (info.season === "Đông" && canChiDay === "Giáp Tý") isTX = true;

                if (isTX) thienXaList.push(`Ngày ${d}/${m}: ${canChiDay} (Tiết ${info.season})`);

                let cls = (new Date(y, m-1, d).getDay() === 0) ? 'sunday' : '';
                if (isTX) cls += ' today'; // Highlight ngày Thiên Xá

                table += `<td class="${cls}" onclick="showDetails(${y},${m},${d},'${lunar.day}/${lunar.month}','${canChiDay}','${info.mc}','${info.nc}','${info.term}')">
                    <strong>${d}</strong><small>${lunar.day}/${lunar.month}</small>
                    ${isTX ? '<span style="font-size:10px;color:red">THIÊN XÁ</span>' : ''}
                </td>`;
            }
            
            document.getElementById('calendar').innerHTML = `<h3>Tháng ${m}/${y}</h3>` + table + '</tr></tbody></table>';
            
            // Hiển thị danh sách Thiên Xá
            const txDiv = document.getElementById('thienXaDaysList');
            txDiv.innerHTML = thienXaList.length ? thienXaList.map(i => `<li>✨ ${i}</li>`).join('') : '<li>Không có ngày Thiên Xá</li>';
        }

        function showDetails(y, m, d, ld, cd, cm, cy, tk) {
            document.getElementById('modal-title').innerText = `Ngày ${d}/${m}/${y}`;
            document.getElementById('modal-details').innerHTML = `<p>Âm lịch: ${ld}</p><p>Ngày: ${cd}</p><p>Tháng: ${cm}</p><p>Năm: ${cy}</p><p>Tiết khí: ${tk}</p>`;
            document.getElementById('dayModal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('dayModal').style.display = 'none'; }
        
        document.getElementById('month').value = new Date().getMonth() + 1;
        generateCalendar();
    </script>
</body>
</html>
